define("loginModule.min",["jquery","shop-initThrift.min","shop-basket.min","shop-common.min"],function(a,b,c,d){function e(){function c(c){var d=a("#result");try{var e=b.authClient.login(a("#uname").val(),a("#password").val());e?(a(".login-error").hide(),c.closest(".modal-auth").length>0?g(c):document.location.replace("./shop.jsp")):(d.val(session.error),d.css("color","black"))}catch(f){a(".login-error").text("Вы ввели неккоректный e-mail или пароль").removeClass("info-good").show()}}function e(c){b.authClient.checkEmailRegistered(a("#email").val());if(""==a("#login").val()||""==a("#email").val()||""==a("#pass").val())a(".email-alert").text("Вы заполнили не все поля !").css("display","block");else if(b.authClient.checkEmailRegistered(a("#email").val()))a(".email-alert").text("Такой e-mail уже зарегистрирован !").css("display","block");else if(d.isValidEmail(a("#email").val())){{b.authClient.registerNewUser(a("#login").val(),"",a("#pass").val(),a("#email").val())}b.authClient.login(a("#email").val(),a("#pass").val()),c.closest(".modal-auth").length>0?g(c):document.location.replace("/shop.jsp")}else a(".email-alert").text("Некорректный email !").css("display","block")}function f(b){a(".widget-box.visible").removeClass("visible"),a("#"+b).addClass("visible")}function g(c){globalUserAuth=!0,c.closest(".modal-auth").modal("hide");var e=b.client.getShops();b.client.getShop(e[0].id),d.changeShortUserInfo(),a(".user-info").after('<i class="icon-caret-down"></i>');var f=a(".dropdown-toggle");f.removeClass("no-login"),a('.user-short .dropdown-toggle:not(".no-login")').click(function(){a(this).parent().removeClass("open")}),d.initBasketInReload();var g=require("shop-basket.min");g.callbacks.fire(g.selectorForCallbacks),g.callbacks.empty()}a(".login-box .btn-primary").click(function(b){b.preventDefault(),c(a(this))}),a(".signup-box .btn-success").click(function(b){b.preventDefault(),e(a(this))}),a(".sendConfirmCode").click(function(c){c.preventDefault();var d=a("#email-forgot").val();if(d){var e="mailTemplates/changePasswordConfirm.html";try{b.authClient.sendConfirmCode(d,e),a(".email-forgot-error").text("На ваш e-mail отправлен код").addClass("info-good").show()}catch(c){a(".email-forgot-error").text("Такой e-mail не зарегистрирован").removeClass("info-good").show()}}else a(".email-forgot-error").text("Введите пожалуйста e-mail").removeClass("info-good").show()}),a(".useConfirmCode").click(function(d){d.preventDefault();var e=a("#email-forgot").val(),f=a("#confirmCode").val(),g=a("#password-new").val(),h=a(".password-new-error");try{b.authClient.confirmRequest(e,f,g),h.hide()}catch(d){h.text("Неверный код подтверждения !").removeClass("info-good").show()}"none"==h.css("display")&&c(a(".login-box .btn-primary"))}),a("#email").keypress(function(){var b=a(".email-alert");"block"==b.css("display")&&b.hide()}),a(".forgot-password-link").click(function(){return f("forgot-box"),!1}),a(".user-signup-link").click(function(){return f("signup-box"),!1}),a(".back-to-login-link").click(function(){return f("login-box"),!1})}return{initLogin:e}});