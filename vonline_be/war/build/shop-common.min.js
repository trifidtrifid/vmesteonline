define("shop-common",["jquery","flexslider","shop-initThrift","shop-basket","shop-spinner","shop-orders","shop-category","bootstrap"],function(a,b,c,d,e){function f(a){try{var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"))}catch(c){alert(c+" Функция getCookie")}return b?decodeURIComponent(b[1]):void 0}function g(a,b,c){try{c=c||{};var d=c.expires;if("number"==typeof d&&d){var e=new Date;e.setTime(e.getTime()+1e3*d),d=c.expires=e}d&&d.toUTCString&&(c.expires=d.toUTCString()),b=encodeURIComponent(b);var f=a+"="+b;for(var g in c){f+="; "+g;var h=c[g];h!==!0&&(f+="="+h)}document.cookie=f}catch(i){alert(i+" Функция setCookie")}}function h(a,b){var d=b?b:c.client.getOrderDetails(a);return(d.weightGramm/1e3).toFixed(1)}function i(b,d){for(var e,f=c.userClient.getCounties(),g=f.length,h=d?d.country.name:b.find(".country-delivery").val(),i=0,j=0;g>j;j++)f[j].name==h&&(e=f[j],i=e.id);i||(e=c.userClient.createNewCountry(h),i=e.id);var k,l=c.userClient.getCities(i),m=l.length,n=d?d.city.name:b.find(".city-delivery").val(),o=0;for(j=0;m>j;j++)l[j].name==n&&(k=l[j],o=k.id);o||(k=c.userClient.createNewCity(i,n),o=k.id);var p,q=c.userClient.getStreets(o),r=q.length,s=d?d.street.name:b.find(".street-delivery").val(),t=0;for(j=0;r>j;j++)q[j].name==s&&(p=q[j],t=p.id);t||(p=c.userClient.createNewStreet(o,s),t=p.id);var u,v=c.userClient.getBuildings(t),w=v.length,x=d?d.building.fullNo:b.find(".building-delivery").val(),y=0;for(j=0;w>j;j++)v[j].fullNo==x&&(u=v[j],y=u.id);y||(u=c.userClient.createNewBuilding(t,x),y=u.id);var z=new com.vmesteonline.be.PostalAddress;return z.country=e,z.city=k,z.street=p,z.building=u,z.staircase=0,z.floor=0,z.flatNo=parseInt(d?d.flatNo:b.find(".flat-delivery").val()),z.comment=a("#order-comment").val(),z}function j(){var b=parseInt((new Date).getTime()/1e3);b-=b%86400;for(var e=86400,f=c.client.getMyOrdersByStatus(b,b+90*e,1),g=f.length,i=0;g>i;i++){var j=f[i].id,k=c.client.getOrderDetails(j);d.addTabToBasketHtml(new Date(1e3*f[i].date),j,k),a(".tab-pane.active").find(".weight span").text(h(j,k));for(var l=k.odrerLines,m=k.odrerLines.length,n=0;m>n;n++){var o,q=l[n].packs,s=0;for(var t in q)q[t]>1&&(s=1);o=r(q)>1||s?!0:!1,d.AddSingleProductToBasket(l[n].product,l[n].quantity,o,k)}}p();var u=a(window).height()-a(".navbar").height()-a("footer").height();a(".catalog-order").css("max-height",u-215)}function k(b){try{b.click(function(b,f){b.preventDefault();var g=a(this).closest(".order-products").length?!0:!1,h=a(this).closest(".catalog").length&&!g?!0:!1,i=a(this).closest(".catalog-confirm").length?!0:!1,j=a(this).closest(".catalog-order").length||i?!0:!1,k=a(this).closest(".product"),l=a(this).find(".product-name").text(),o=k.data("productid"),p=a(this).find("img").attr("src").split("?"),q={name:l,price:k.find(".product-price").text(),unitName:k.find(".unit-name").text(),imageURL:p[0]},r=a(this).find("+.modal"),s=r.find(".modal-body").length,t=k.data("prepack");if(s){if(j||g)t&&(G=!1,e.initPrepackRequiredInModal(a(this),r,k,G));else if(t){var u;u=k.hasClass("added")?0:r.find(".prepack-line").length;var v=268;v+=53*u,r.height(v)}}else{var x=c.client.getProductDetails(o),y=x.imagesURLset,z=x.optionsMap;y.length&&r.height("275px"),t&&r.addClass("modal-with-prepack");var A=k.find(".td-spinner .spinner1").data("step"),B="";if(B+='<div class="modal-body"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><div class="product-slider"><div class="slider flexslider"><ul class="slides"><li><img src="'+q.imageURL+'" /></li>',y.length)for(var C=0;C<y.length;C++)B+='<li><img src="'+y[C]+'" /></li>';if(B+="</ul></div>",y.length){for(B+='<div class="carousel flexslider"><ul class="slides"><li><img src="'+q.imageURL+'" /></li>',C=0;C<y.length;C++)B+='<li><img src="'+y[C]+'" /></li>';B+="</ul></div>"}B+='</div><div class="product-descr"><h3>'+q.name+'</h3><div class="product-text"><div class="product-options">';for(var D in z)B+="<div>"+D+" "+z[D]+"</div>";B+="</div>",B+=t?'<div class="modal-footer with-prepack"><span>Цена: '+q.price+'</span><div class="prepack-item packs"><input type="text" class="input-mini spinner1 prepack" /><span>упаковок</span></div><div class="prepack-item">по</div><div class="prepack-item qnty"><input type="text" data-step="'+A+'" class="input-mini spinner1" /><span>'+q.unitName+'</span></div><div class="prepack-item"><a href="#" title="Добавить" class="fa fa-plus prepack-open"></a></div>':'<div class="modal-footer"><span>Цена: '+q.price+'</span><div class="prepack-item"><input type="text" class="input-mini spinner1" /><span>'+q.unitName+"</span></div>",B+='<a href="#" title="Добавить в корзину" class="fa fa-shopping-cart"></a>',B+='<div class="prepack-list"></div><br><div class="error-info error-prepack"></div><a href="#" class="btn btn-primary btn-sm no-border full-descr">Подробное описание</a><div class=\'product-fullDescr\'>'+x.fullDescr+"</div></div></div></div>",r.append(B);var E,F;if(j||g){if(t){var G=!0;e.initPrepackRequiredInModal(a(this),r,k,G,j)}else E=k.find(".ace-spinner").spinner("value"),F=k.find(".td-spinner .spinner1").data("step"),e.InitSpinner(r.find(".spinner1"),E,j,F);g&&d.InitAddToBasket(r.find(".fa-shopping-cart"))}else E=k.find(".ace-spinner").spinner("value"),t?(e.InitSpinner(r.find(".packs .spinner1"),1),e.InitSpinner(r.find(".qnty .spinner1"),E,0,A)):e.InitSpinner(r.find(".spinner1"),E,0,A),d.InitAddToBasket(r.find(".fa-shopping-cart"));var H={isBasket:j,productSelector:k,productId:o};m(r,H),n(r),j&&r.find(".fa-shopping-cart").click(function(){var b=a(".tab-pane.active").data("orderid"),c=!0,d=e.singleSetOrderLine(k,b,o,c);if(!d.errorFlag){var f=a(this).closest(a(this).closest(".catalog-order").length?".catalog-order":".catalog-confirm");e.updateWeightAndAmount(b,f,d.updateInfo),r.modal("hide"),a(".basket-backdrop").hide()}return!1}),r.find(".close").click(function(b,c){!c&&h&&window.history.back(),a(".basket-backdrop").hide()})}var I="p";if(!f&&h){var J={type:"modal",productid:o};window.history.pushState(J,null,"shop.jsp#"+I+"="+o)}r.modal(),j&&!i&&(a(".modal-backdrop").hide(),a(".modal-backdrop.basket-backdrop").show()),w=r.find(".product-fullDescr").height(),r.find(".product-fullDescr").hide(),a(".modal-backdrop").click(function(){h&&window.history.back(),a(".modal.in .close").trigger("click"),a(this).hide()});var K=r.find(".carousel"),L=r.find(".slider");K.flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:60,itemMargin:5,asNavFor:L}),L.flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,sync:K})})}catch(f){alert(f+" Функция InitProductDetailPopup")}}function l(b,c){var d=c?c:!1;a(".catalog .product").each(function(){a(this).data("productid")==b&&a(this).find(".product-link").trigger("click",[d])})}function m(b,c){b.find(".prepack-open").click(function(b){b.preventDefault();var d=a(this).closest(".modal-footer").find(">.qnty .spinner1").data("step"),f=c.isBasket,g=c.productSelector,h=c.productId,i='<div class="prepack-line no-init"><div class="prepack-item packs"><input type="text" class="input-mini spinner1 prepack" /><span>упаковок</span></div><div class="prepack-item">по</div><div class="prepack-item qnty"><input type="text" data-step="'+d+'" class="input-mini spinner1" /><span>'+a(this).closest(".prepack-item").prev().find("span").text()+'</span></div><div class="prepack-item"><a href="#" class="remove-prepack-line" title="Удалить">×</a></div></div>';a(this).closest(".modal-footer").find(".prepack-list").append(i);var j=a(".prepack-line.no-init");e.InitSpinner(j.find(".packs .spinner1"),1,f),e.InitSpinner(j.find(".qnty .spinner1"),d,f,d),e.initRemovePrepackLine(j.find(".prepack-item .remove-prepack-line"),h,g),j.removeClass("no-init");var k=a(this).closest(".modal").height();a(this).closest(".modal").height(k+53)})}function n(b){b.find(".full-descr").click(function(){var b,c=a(".product-fullDescr");b=a(this).closest(".modal").height();var d;"none"==c.css("display")?(d=b+w+10,a(this).closest(".modal").height(d),c.show(200)):(d=b-w-10,c.hide(200,function(){a(this).closest(".modal").height(d)}))})}function o(b,d){try{var e=a(".tab-pane.active").data("orderid"),f=d?d:c.client.getOrderDetails(e),g=f.totalCost;g||(g=0,b.find(".td-summa").each(function(){g+=parseFloat(a(this).text())})),g+=f.deliveryCost}catch(h){}return g.toFixed(1)}function p(){var b,c=a(".catalog tr"),d=a(".tabs-days .tab-content .catalog-order li"),e=d.length;c.each(function(){for(var c=0;e>c;c++)b=d.eq(c).data("productid"),a(this).data("productid")==b&&a(this).addClass("added")})}function q(){var b,c=a(".catalog tr.added"),d=a(".tabs-days .tab-content .catalog-order li"),e=d.length;c.each(function(){for(var c=0;e>c;c++)b=d.eq(c).data("productid"),a(this).data("productid")==b&&a(this).removeClass("added")})}function r(a){var b=0;for(var c in a)c&&a[c]&&b++;return b}function s(){try{var b=a(".main-content");b.height()>a(window).height()-45?a(".shop-right").css("height",b.height()+45):a(".shop-right").css("height","100%")}catch(c){alert(c+" Функция setSidebarHeight")}}function t(){var b=a(".modal.in");b.length&&b.modal("hide");var c=a(".modal-auth");c.load("login.jsp .login-container",function(){var b='<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>';c.find(".reg-form").prepend(b),a.ajax({url:"js/login.js",dataType:"script"})}).modal()}function u(a){return/^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/.test(a)}function v(b){var d=b?b:c.userClient.getShortUserInfo(),e=d.firstName+" "+d.lastName;a(".user-info").html(e)}var w,x="i/no-photo.png";return a(".shop-trigger").click(function(b){b.preventDefault();var d=a(".shop-orders"),e=a(".orders-list");a(".page").hide(),a("footer").addClass("short-footer");var f;if(a(this).hasClass("back-to-shop")){d.hide(),a(".shop-confirm").hide(),a(".main-container-inner").show(),a(".navbar .nav li.active").removeClass("active"),a(".navbar .nav li:eq(0)").addClass("active");var g=a(".shop-products");if(g.find(".shop-menu .shopmenu-back").length){var h=require("shop-category");h.InitLoadCategory(0)}g.show(function(){s()}),f={type:"default"},window.history.pushState(f,null,"shop.jsp")}else{var i=document.location.hash;"#orders-history"!=i&&(f={type:"page",pageName:"orders-history"},window.history.pushState(f,null,"shop.jsp#"+f.pageName));var j=require("shop-orders");if(globalUserAuth){a(".shop-products").hide(),a(".shop-confirm").hide(),a(".main-container-inner").show();var l=parseInt((new Date).getTime()/1e3);l-=l%86400;var m=86400,n=c.client.getMyOrdersByStatus(0,l+90*m,0);j.initVarForMoreOrders(),e.html("").append(j.createOrdersHtml(n)),k(a(".shop-orders .product-link")),j.initShowMoreOrders(n),j.initOrdersLinks();var o=a(".orders-no-init");j.initOrderPlusMinus(o),j.initOrderBtns(o),o.removeClass("orders-no-init"),d.show(),s()}else{var q=require("shop-basket");q.callbacks.add(j.GoToOrdersTrigger),t()}}p()}),{getCookie:f,setCookie:g,noPhotoPic:x,initBasketInReload:j,InitProductDetailPopup:k,countAmount:o,getPacksLength:r,setSidebarHeight:s,openModalAuth:t,markAddedProduct:p,remarkAddedProduct:q,addAddressToBase:i,isValidEmail:u,changeShortUserInfo:v,getOrderWeight:h,identificateModal:l}});