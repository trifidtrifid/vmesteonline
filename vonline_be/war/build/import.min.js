define("import.min",["jquery","shop-initThrift.min","bo-common.min"],function(a,b,c){function d(){function d(){a(".show-full-text").click(function(b){if(b.preventDefault(),a(this).closest(".export-table").length>0)var c=b.pageX-330,d=b.pageY-90;else c=b.pageX-200,d=b.pageY-200;a(".full-text").hide(),a(this).parent().find(".full-text").css({left:c,top:d}).show()})}function e(){a(".full-text .close").click(function(b){b.preventDefault(),a(this).parent().hide()})}function f(a,b,c,d){for(var e="",f=a.length,g=c.length,h="",i=!1,j=0;g>j;j++)i||(h+='<li data-fieldtype="'+d[j]+'"><a href="#">'+c[j]+"</a></li>"),c[j]==n&&(i=!0);for(i||(h+='<li data-fieldtype="-1"><a href="#">'+n+"</a></li>"),j=0;f>j;j++)e+='<td><div class="btn-group import-field-dropdown"><button data-toggle="dropdown" data-fieldtype="'+b[j]+'" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">'+a[j]+'</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+h+"</ul></div></td>";return e}function g(a,b){function c(a,b){for(var c,d="",e="",f=0;b>f;f++)e=a[f],e&&e.length>30&&(c=e,e=e.slice(0,30),e+=" <a class='show-full-text' href='#'>...</a>"+'<div class="full-text"><a href="#" class="close">×</a>'+c+"</div>"),d+="<td>"+e+"</td>";return d}for(var d="",e=a.length,f=0;e>f;f++)d+="<tr>"+c(a[f],b)+"</tr>";return d}var h=parseInt((new Date).getTime()/1e3);h-=h%86400;var i,j,k,l,m=[];a(".form-import").submit(function(h){h.preventDefault();var o=a("#import-data").val();if("Тип импортируемых данных"==a(".import-dropdown .btn-group-text").text())a(".import").find(".error-info").text("Пожалуйста, укажите тип импортируемых данных.").show();else if(o){{a("#import-public").val()}o=o.split("\\");var p=o.length,q=(o[p-1],new FormData),r=a(".form-import #import-data");q.append("data",r[0].files[0]),a.ajax({type:"POST",url:"/file/",cache:!1,processData:!1,contentType:!1,data:q,success:function(h){l=h;var o=b.clientBO.parseCSVfile(l);i=o.elems,j=o.rowCount;var p=i.length;k=p/j;var q=0;m=[];for(var r=0;j>r;r++){m[r]=[];for(var s=0;k>s;s++)m[r][s]=i[q++]}var t=a(".import-dropdown .btn-group-text").text(),u=[],v=[],w=com.vmesteonline.be.shop.bo.ExchangeFieldType;switch(q=0,t){case"Продукты":for(var x in w)w[x]>=300&&w[x]<330&&(u[q]=x,v[q++]=w[x]);break;case"Категории продуктов":for(x in w)w[x]>=200&&w[x]<230&&(u[q]=x,v[q++]=w[x]);break;case"Производители":for(x in w)w[x]>=100&&w[x]<130&&(u[q]=x,v[q++]=w[x])}var y,z,A=u.slice(0),B=v.slice(0);if(q>k)for(y=q,z=k,r=y-1;r>=z;r--)u.pop(),v.pop();if(k>q)for(y=k,z=q,r=y-1;r>=z;r--)u[r]=n,v[r]=-1;var C="<table><thead><tr>"+f(u,v,A,B)+"</tr></thead><tbody>"+g(m,u.length)+"</tbody></table>";a(".import-table").html("").prepend(C).parent().show(),a(".top-scroll").remove(),c.DoubleScroll(document.getElementById("doublescroll")),d(),e(),a(".import-field-dropdown .dropdown-toggle").click(function(b){b.preventDefault();var c=a(this).closest("td").index(),d=0,e=0;a(".import-table table").find("td").each(function(){c>e&&(d+=a(this).width()),e++}),d-=a(".import-table").scrollLeft();var f=94;a(this).parent().find(".dropdown-menu").css({left:d,top:f})}),a(".import-field-dropdown .dropdown-menu").find("li a").click(function(b){b.preventDefault();var c=a(this).parent().text(),d=a(this).parent().data("fieldtype");a(".import-field-dropdown").each(function(){a(this).find(".btn-group-text").text()==c&&(a(this).find(".dropdown-toggle").attr("data-fieldtype",-1),a(this).find(".btn-group-text").text(n))});var e=a(this).closest(".import-field-dropdown");e.find(".btn-group-text").text(c).parent().data("fieldtype",d)}),c.setSidebarHeight(a(".main-content").height())}})}else a(".import").find(".error-info").text("Пожалуйста, выберите файл.").show()}),a("#import-data").click(function(){a(".import").find(".error-info").hide()}),a(".checkbox .lbl").click(function(){a(this).closest(".checkbox").toggleClass("active")}),a(".import-dropdown .dropdown-menu li").click(function(){a(".import").find(".error-info").hide()});var n="SKIP";a(".import-btn").click(function(c){function d(){a(".confirm-info").hide()}c.preventDefault();var e=a(".import-field-dropdown"),f=e.length,g="",i=!1;e.each(function(){if(!i)for(var b=a(this).parent().index(),c=a(this).find(".btn-group-text").text(),d=b+1;f>d;d++)if(c==e.eq(d).find(".btn-group-text").text()&&c!=n){g=c,i=!0;break}});var j=a(this).closest(".back-tab").find(".confirm-info");if(i)j.text("Вы указали два столбца с одинаковым занчением : "+g).show();else{j.hide();var k,m=a(".import-dropdown .btn-group-text").text();switch(m){case"Продукты":k=com.vmesteonline.be.shop.bo.ImExType.IMPORT_PRODUCTS;break;case"Категории продуктов":k=com.vmesteonline.be.shop.bo.ImExType.IMPORT_CATEGORIES;break;case"Производители":k=com.vmesteonline.be.shop.bo.ImExType.IMPORT_PRODUCERS}var o=[],p=0;a(".import .import-field-dropdown").each(function(){var b=a(this).find(".btn-group-text").text();b!=n&&(o[p]=parseInt(a(this).find(".btn").data("fieldtype"))),p++});var q=new com.vmesteonline.be.shop.bo.ImportElement;q.type=k,q.filename="filename",q.fieldsMap=o,q.url=l;var r=[];r[0]=q;var s=new com.vmesteonline.be.shop.bo.DataSet;s.name="name",s.date=h,s.data=r,a(".loading").fadeIn(function(){try{b.clientBO.importData(s),j.text("Данные успешно импортированы.").addClass("info-good").show()}catch(c){j.text("Ошибка импорта.").show()}a(".loading").fadeOut(0),setTimeout(d,3e3)})}})}return{initImport:d}});