define("shop-basket.min",["jquery","shop-initThrift.min","shop-spinner.min","shop-common.min","shop-search.min","shop-orders.min","bootbox"],function(a,b,c,d,e,f){function g(){var b=require("shop-common.min");if(b.remarkAddedProduct(),a(".tab-pane").length>1){var c=a(".tabs-days").find(".nav li.active"),d=a(".tab-pane.active");d.removeClass("active").next().addClass("active"),d.hide().remove(),c.removeClass("active").next().addClass("active"),c.hide().remove()}else a(".tabs-days").hide().remove()}function h(c,d){try{c.click(function(e){function f(c,e,f){c.closest(".product").slideUp(function(){var c=a(this).data("productid");a(".catalog").find(".added").each(function(){a(this).data("productid")==c&&a(this).removeClass("added")});var g=require("shop-common.min");h&&(i=d?d:b.client.getOrderDetails(k),a(".tabs-days .tab-content .catalog-order").find(".product").each(function(){a(this).data("productid")==c&&a(this).css("display","none").detach()}),a(".itogo-right span").text(g.countAmount(j.find(".catalog-order"),i))),a(this).detach(),b.client.removeOrderLine(k,a(this).closest(".product").data("productid")),i=b.client.getOrderDetails(k),j.find(".amount span").text(g.countAmount(j.find(".catalog-order"),i));var m=g.getOrderWeight(k,i);j.find(".weight span").text(m),a(".weight-right span").text(m),e&&(j.closest(".tabs-days").hide().remove(),b.client.deleteOrder(k)),f&&l.trigger("click")})}e.preventDefault();var g,h,i,j=a(".tab-pane.active"),k=j.data("orderid");h=a(this).closest(".confirm-order").length>0,g=h?a(this).closest(".catalog-confirm").find(".product"):c.closest(".catalog-order").find(".product");var l=a(this).closest(".confirm-order").find(".additionally-order .btn-cancel");if(1==g.length)if(h){var m=a(this);bootbox.confirm("Вы действительно хотите отменить заказ ?",function(a){if(a){var b=!0,c=!0;f(m,b,c)}})}else{var n=!0;f(a(this),n)}else f(a(this))})}catch(e){alert(e+" Функция InitDeleteProduct")}}function i(c){try{c.click(function(c){c.preventDefault();var d=!1;if(globalUserAuth){var e=a(this).closest(".product"),f=e.find(".td-spinner .ace-spinner").spinner("value"),g={id:e.data("productid"),imageURL:e.find(".product-link img").attr("src"),name:e.find(".product-name").text(),price:e.find(".product-price").text(),unitName:e.find(".unit-name").text(),minClientPack:e.find(".td-spinner .ace-spinner .spinner1").data("step"),prepackLine:e.find(".prepack-line"),prepackRequired:e.data("prepack"),qnty:f,packVal:1,quantVal:e.find(".td-spinner .spinner1").data("step")},h=[];if(g.prepackRequired){g.quantVal=f;var i=e.find(".modal-body").length>0;if(i){var j=e.find(".packs:eq(0) .ace-spinner").spinner("value"),l=e.find(".qnty .ace-spinner").eq(0).spinner("value");if(g.packVal=j,g.quantVal=l,g.qnty=j*l,h[l]=j,0!=g.prepackLine.length){var m=0,n=a(".modal-footer.with-prepack>.qnty .ace-spinner").spinner("value");g.prepackLine.each(function(){j=a(this).find(".packs .ace-spinner").spinner("value"),l=a(this).find(".qnty .ace-spinner").spinner("value"),(l==m||l==n)&&(e.find(".error-prepack").text("Товар не возможно добавить: вы создали две линни с одинаковым количеством продукта").show(),d=!0),h[l]=j,g.qnty+=j*l,m=l})}}else{var p=a(this).closest(".order-item").length>0;if(p)for(var q=a(this).closest(".order-item").data("orderid"),r=b.client.getOrderDetails(q),s=r.odrerLines,t=s.length,u=0;t>u;u++)s[u].product.id==a(this).closest(".product").data("productid")&&(h=s[u].packs);else h[g.qnty]=1,g.packsQnty=1}}else h=0;if(!d){if(0==a(".tabs-days").length){var v=b.client.createOrder(0),w=new Date(1e3*v.date);k(w,v.id,r)}o(g,h),e.addClass("added")}var y=a(this).closest(".modal").length>0;y&&!d&&(a(this).closest(".modal").find(".close").trigger("click"),e.find(".error-prepack").hide())}else{x=a(this);var z=require("shop-common.min");z.openModalAuth()}})}catch(d){alert(d+" Функция InitAddToBasket")}}function j(a){var b;switch(a){case 0:b="ВС";break;case 1:b="ПН";break;case 2:b="ВТ";break;case 3:b="СР";break;case 4:b="ЧТ";break;case 5:b="ПТ";break;case 6:b="СБ"}return b}function k(c,d,e){var f=c.getDate(),h=c.getDay(),i=c.getMonth()+1;if(f=10>f?"0"+f:f,i=10>i?"0"+i:i,h=j(h),0==a(".tabs-days").length){var k='<div class="tabbable tabs-right tabs-days"><ul class="nav nav-tabs" id="myTab3"><li class="active"><a data-toggle="tab" href="#day'+f+i+'">'+h+"<span>"+f+"."+i+'</span></a></li></ul><div class="tab-content"><div id="day'+f+i+'" data-orderid="'+d+'" class="tab-pane active"><div class="basket-head"><div class="weight">Вес: <span></span> кг.</div><div class="amount">Итого: <span></span> руб.</div></div><ul class="catalog-order"></ul><div class="basket-bottom"><a class="refresh">Обновить</a><a href="#" class="btn btn-sm btn-primary no-border btn-order">Оформить</a><a href="#" class="btn btn-sm btn-cancel no-border">Отменить</a></div></div></div></div>';a(".shop-right").append(k)}else{var m=a(".tabs-days");a(".tabs-days .active").removeClass("active"),k='<li class="active"><a data-toggle="tab" href="#day'+d+'">'+h+"<span>"+f+"."+i+"</span></a></li>",m.find(".nav-tabs").append(k),k='<div id="day'+d+'" data-orderid="'+d+'" class="tab-pane active"><div class="basket-head"><div class="amount">Итого: <span></span></div></div><ul class="catalog-order"></ul><div class="basket-bottom"><a class="refresh">Обновить</a><a href="#" class="btn btn-sm btn-primary no-border btn-order">Оформить</a><a href="#" class="btn btn-sm btn-cancel no-border">Отменить</a></div></div>',m.find(".tab-content").append(k)}var n=require("shop-spinner.min");n.initRefresh();var o=a(".tabs-days .tab-pane.active");o.find(".btn-cancel").on(ace.click_event,function(c,d){c.preventDefault(),bootbox.confirm("Вы действительно хотите отменить заказ ?",function(c){if(c){var e=a(".tab-pane.active").data("orderid");g(),b.client.cancelOrder(e),d&&b.client.deleteOrder(e)}}),a(".modal-backdrop").click(function(){a(".modal.in .close").trigger("click"),a(this).hide()})}),o.find(".btn-order").click(function(b){b.preventDefault();var c=a(".tab-pane.active");c.find(".refresh").trigger("click");var d=require("shop-common.min"),g=d.countAmount(c.find(".catalog-order"),e),j=a(".weight span").text(),k=c.find(".catalog-order").html(),m=[],n=[],o=0;c.find(".catalog-order td .spinner1").each(function(){m[o]=a(this).closest(".ace-spinner").spinner("value"),n[o++]=a(this).data("step")}),a(".page").hide();var p={orderDay:f,orderMonth:i,orderWeekDay:h};l(k,g,m,p,j)})}function l(d,e,f,g,i){a(".shop-confirm").load("../ajax/ajax-confirmOrder.html .dynamic",function(){a("footer").removeClass("short-footer");var j=document.location.hash;if("#confirm-order"!=j){var k={type:"page",pageName:"confirm-order"};window.history.pushState(k,null,"shop.jsp#"+k.pageName)}var l,n=a(".tab-pane.active").data("orderid"),o=b.client.getOrderDetails(n),p=a(".delivery-right .radio");p.find("input").prop("checked",!1);var q=a(".shop.dynamic").attr("id"),r=b.client.getShop(q),t=r.address;switch(o.delivery){case 1:p.find('input:not(".courier-delivery")').prop("checked",!0),s(t);break;default:p.find("input.courier-delivery").prop("checked",!0),s(o.deliveryTo);var x=b.client.getUserDeliveryAddresses().elems;y=o.deliveryTo,u(n,x)}var z=a(".confirm-order .catalog-confirm");z.html(d),w(n,o),v(t),l="string"==typeof g?g:g.orderDay+"."+g.orderMonth+" ("+g.orderWeekDay+")",a(".order-date span").text(l),a(".itogo-right span").text(e),a(".weight-right span").text(i),z.find(".modal-body").remove();var A=0,B=b.userClient.getUserContacts();B.mobilePhone&&a("#phone-delivery").val(B.mobilePhone),z.find("td .ace-spinner").each(function(){var b=a(this).find(".spinner1").data("step");a(this).after('<input type="text" data-step="'+b+'" class="input-mini spinner1 spinner-input form-control no-init" maxlength="3">'),c.InitSpinner(a(this).find("+.spinner1"),f[A++],1,b),a(this).find(".spinner1").attr("disabled")&&a(this).find("+.ace-spinner").spinner("disable"),a(this).remove()}),h(z.find(".delete-product"),o);var C=require("shop-common.min");C.InitProductDetailPopup(z.find(".product-link")),c.initRefresh();var D={orderId:n,userContacts:B,shop:r};m(a(".confirm-order .btn-order"),D),a(".confirm-order .btn-cancel").click(function(){a(".page.shop-confirm").hide(),window.history.back()})}).show()}function m(c,d){c.click(function(){var c=a("#phone-delivery"),e=a(".alert-delivery-phone"),h=d.orderId,i=d.shop,k=a(".delivery-address").find(".error-info").length>0;if(c.val()){var l=0;try{d.userContacts.mobilePhone!=c.val()&&(d.userContacts.mobilePhone=c.val(),b.userClient.updateUserContacts(d.userContacts))}catch(m){l=1,e.text("Телефон должен быть вида 79219876543, +7(821)1234567 и т.п").show()}var o;k&&(o=b.client.setOrderDeliveryType(h,1),s(i.address)),l||(e.hide(),g(),a(".shop-orderEnd").load("../ajax/ajax-orderEnd.html .dynamic",function(){a(".page").hide(),a(this).show();var c=b.client.getOrder(h);o=o?o:b.client.getOrderDetails(h);var d=a(".itogo-right span").text();a(".bill-amount span,.all-amount span").text(d),a(".bill-delivery-address span").text(a(".input-delivery .delivery-address").text()),a(".bill-date-delivery span").text(a(".order-date span").text()),a(".bill-client span").text(a(".user-info").text()),a(".bill-client-phone span").text(a("#phone-delivery").val()),a(".bill-pay-type span").text(n(o.paymentType)),a(".bill-weight span").text(a(".weight-right span").text()+" кг.");var e=new Date(1e3*o.createdAt),g=e.getDate(),k=e.getDay(),l=e.getMonth()+1;g=10>g?"0"+g:g,l=10>l?"0"+l:l,k=j(k),a(".bill-shop-name span").text(i.name),a(".bill-order-number span").text(c.id),a(".bill-date-order span").text(g+"."+l+" ("+k+")"),a(".bill-shop-phone span").text("---"),a(".bill-shop-email span").text("---"),a(".order-end-logo img").attr("src",i.logoURL);var m=a(".delivery-cost").text(),p=d-m,q=a(".bill-delivery span");q.text("0"!=m?m+" р.":"---"),a(".bill-amount-order span").text(p.toFixed(1));var r="",s=a("#order-comment");if(s.val()){var t="<div class='bill-comment'><h4>Комментарий: </h4><div>"+s.val()+"</div></div>";a(".bill-delivery").after(t),r=s.val()}b.client.confirmOrder(h,r);var u=!0;a(".bill-order-list").append(f.createOrdersProductHtml(o,u))}))}else e.text("Пожалуйста введите номер телефона.").show(),a("#phone-delivery").focus()})}function n(a){var b;switch(a){case 0:b="Неизвестно";break;case 1:b="Наличными";break;case 2:b="Кредитной карточкой";break;case 3:b="Трансфер";break;case 4:b="Кредит"}return b}function o(c,d){var e=0,f=a(".tab-pane.active"),g=f.data("orderid"),h=require("shop-common.min");a(".catalog-order li").each(function(){a(this).data("productid")==c.id&&(e=1)});var i;if(e){var j=a('.catalog-order li[data-productid="'+c.id+'"]'),k=j.find(".td-spinner .ace-spinner"),l=c.qnty;k.spinner("value",parseFloat(l).toFixed(1));k.spinner(h.getPacksLength(d)<=1?"enable":"disable"),i=b.client.setOrderLine(g,c.id,l,"",d),f.find(".weight span").text(h.getOrderWeight(g,i));var m=(l*parseFloat(j.find(".td-price").text())).toFixed(1);j.find(".td-summa").text(m),f.find(".amount span").text(h.countAmount(f.find(".catalog-order"),i))}else i=b.client.setOrderLine(g,c.id,c.qnty,"",d),p(c,c.qnty,0,i),f.find(".weight span").text(h.getOrderWeight(g,i));(c.packVal>1||0!=c.prepackLine.length||d&&h.getPacksLength(d)>1)&&(k=a('.catalog-order li[data-productid="'+c.id+'"]').find(".td-spinner .ace-spinner"),k.spinner("disable"))}function p(b,d,e,f){try{var g,i=require("shop-common.min");g=b.imageURL?b.imageURL:i.noPhotoPic;var j='<li class="product" data-productid="'+b.id+'" data-prepack="'+b.prepackRequired+'"><table><tr><td class="td-price product-price">'+b.price+'</td><td class="td-spinner"><input type="text" data-step="'+b.minClientPack+'" class="input-mini spinner1 no-init" /><span class="unit-name">'+b.unitName+'</span></td><td class="td-summa">'+(b.price*d).toFixed(1)+'</td><td class="td-close"><a href="#" class="delete-product no-init">×</a></td></tr></table><a href="#" class="product-link no-init"><span><img src="'+g+'" alt="'+b.name+'"/></span><div class="product-right-descr product-name">'+b.name+'</div></a><div class="modal"></div></li>'}catch(k){alert(k+" Функция AddSingleProductToBasket")}var l=a(".tab-pane.active"),m=l.find(".catalog-order");m.append(j),l.find(".amount span").text(i.countAmount(m,f));var n=l.find(".catalog-order .delete-product.no-init");h(n,f),n.removeClass("no-init");var o=l.find(".catalog-order .product-link.no-init");i.InitProductDetailPopup(o),o.removeClass("no-init");var p=l.find(".catalog-order .spinner1.no-init"),q=1;c.InitSpinner(p,parseFloat(d).toFixed(1),q,b.minClientPack),e&&p.closest(".ace-spinner").spinner("disable"),p.removeClass("no-init")}function q(a){a.trigger("click")}function r(){try{var a=parseInt(new Date/1e3);a-=a%86400;var c=b.client.getNextOrderDate(a)}catch(d){alert(d+" Функция SetFreeDates")}return c.orderDate}function s(b){a(".input-delivery .delivery-address").text(b.country.name+", "+b.city.name+", "+b.street.name+" "+b.building.fullNo+", кв. "+b.flatNo)}function t(c,d,e){for(var f,g=d?d:b.client.getUserDeliveryAddresses().elems,h="",i=g.length,j=0;i>j;j++)f=b.client.getUserDeliveryAddress(g[j]),h+='<li><a data-addresstext="'+g[j]+'" href="#">'+f.street.name+" "+f.building.fullNo+", кв. "+f.flatNo+"</a></li>";h+='<li class="divider"></li><li><a href="#" class="delivery-add-address">Добавить адрес ...</a></li>',a(".delivery-dropdown .dropdown-menu").html("").prepend(h),a('.delivery-dropdown .dropdown-menu a:not(".delivery-add-address")').click(function(d){d.preventDefault();var e=a(this).parent().index();y=b.client.getUserDeliveryAddress(g[e]),s(y);var f=a(this).data("addresstext"),h=b.client.getDeliveryAddressViewURL(f,D,E);a(".address-map").remove(),a(this).closest(".input-delivery").find(".address-input").after("<img class='address-map' src='"+h+"'>");var i=b.client.setOrderDeliveryType(c,2,y);w(c,i)}),a(".delivery-add-address").click(function(b){b.preventDefault(),a(".address-input .street-delivery").val(""),a(".address-input .building-delivery").val(""),a(".address-input .flat-delivery").val(""),a(".address-input").show(),a(".delivery-dropdown .btn-group-text").text("Выбрать адрес")}),e||a(".add-address").click(function(d){d.preventDefault();var e=a(".street-delivery").val(),f=a(".building-delivery").val(),g=a(".flat-delivery").val();if(a(".country-delivery").val()&&a(".city-delivery").val()&&e&&f&&g){var h=e+" "+f,i=y=b.client.createDeliveryAddress(h,parseInt(g),0,0,0),j=b.client.getDeliveryAddressViewURL(h,D,E);a(".address-map").remove(),a(this).closest(".address-input").after("<img class='address-map' src='"+j+"'>"),a(".alert-delivery-addr").hide();var k=a(".address-input");k.slideUp();var l=require("shop-common.min");l.addAddressToBase(k,i),s(i);var m=b.client.setOrderDeliveryType(c,2,i);w(c,m);var n=!0;t(c,0,n)}else a(".alert-delivery-phone").hide(),a(".alert-delivery-addr").text("Введите полный адрес доставки !").show()})}function u(b,c){a(".delivery-dropdown").show(),t(b,c)}function v(c){a(".radio input").click(function(){var d,e=a(".itogo-right span"),f=a(".tab-pane.active").data("orderid"),g=require("shop-common.min"),h=b.client.getUserDeliveryAddresses().elems;if(a(this).hasClass("courier-delivery")){var i=b.userClient.getUserContacts().homeAddress;h.length||(y=null),y||(i?y=i:h.length&&(y=b.client.getUserDeliveryAddress(h[0])));var j=y;if(u(f,h),j?(s(j),d=b.client.setOrderDeliveryType(f,2,j),w(f,d)):(a(".input-delivery .delivery-address").html("<span class='error-info'>Введите пожалуйста адрес доставки.</span>"),a(".input-delivery .delivery-address .error-info").show(),a(".delivery-add-address").trigger("click")),e.text(g.countAmount(a(".confirm-order"),d)),C=1,B){var k=require("shop-search.min");k.initAutocompleteAddress(a(".address-input")),B=0}a(".address-map").slideDown(200)}else d=b.client.setOrderDeliveryType(f,1),a(".address-map").slideUp(200),s(c),w(f,d),a(".delivery-dropdown").hide(),C&&(e.text(g.countAmount(a(".confirm-order")),d),C=0)})}function w(c,d,e){var f=d?d:b.client.getOrderDetails(c);a(".delivery-cost").text(f.deliveryCost?f.deliveryCost:"0");var g=require("shop-common.min"),h=e?e:a(".catalog-confirm");a(".itogo-right span,.amount span").text(g.countAmount(h,d))}bootbox.setDefaults({locale:"ru"});var x,y,z=0,A=a.Callbacks(),B=1,C=0,D=400,E=300;return{cleanBasket:g,InitDeleteProduct:h,flagFromBasketClick:z,AddProductToBasketCommon:o,InitAddToBasket:i,BasketTrigger:q,AddSingleProductToBasket:p,addTabToBasketHtml:k,setDeliveryCost:w,GoToConfirm:l,getWeekDay:j,getNextDate:r,callbacks:A,selectorForCallbacks:x}});