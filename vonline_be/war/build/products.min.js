define("products.min",["jquery","shop-initThrift.min","bo-common.min"],function(a,b,c){function d(a){var b=allCategories,c=b.length,d="";if(a){for(var e,f=0;c>f;f++)b[f].id==a&&(e=b[f]);return e}for(var f=0;c>f;f++)d+='<li data-categoryid="'+b[f].id+'"><a href="#">'+b[f].name+"</a></li>";var g='<div class="btn-group categories-dropdown"><button data-toggle="dropdown" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">Добавить</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+d+"</ul></div>";return g}function e(){function e(){function e(b,c){var d=new com.vmesteonline.be.shop.FullProductInfo;d.product=new com.vmesteonline.be.shop.Product,d.details=new com.vmesteonline.be.shop.ProductDetails,d.product.id=c?0:b.attr("id"),d.product.name=b.find(".product-name textarea").val(),d.product.shortDescr=b.find(".product-shortDescr textarea").val(),d.product.producerId=b.find(".product-producer").data("producerid");var e=b.find(".product-imageURL .file-name img");d.product.imageURL=e.length?e.css("background-image"):b.find(".product-imageURL>img").attr("src"),d.product.weight=b.find(".product-weight input").val()?parseFloat(b.find(".product-weight input").val()):0,d.product.price=b.find(".product-price input").val()?parseFloat(b.find(".product-price input").val()):0,d.product.unitName=b.find(".product-unitName input").val(),d.product.minClientPack=b.find(".product-pack input").val()?parseFloat(b.find(".product-pack input").val()):0,d.product.prepackRequired=b.find(".product-prepack input").attr("checked")?!0:!1,d.details.fullDescr=b.find(".product-fullDescr textarea").val();var f=0,g=b.find(".product-imagesSet").find(".file-name img").length;if(g){var h=[];b.find(".product-imagesSet .ace-file-input.added").each(function(){h[f++]=a(this).find(".file-name img").css("background-image")}),d.details.imagesURLset=h}f=0;var i=[];b.find(".product-categories .category-item").each(function(){i[f++]=a(this).data("categoryid")}),d.details.categories=i;var j=[];b.find(".product-options table tr").each(function(){j[a(this).find("td:eq(0)").text()]=a(this).find("td:eq(1)").text()}),d.details.options=j;var k=[];return b.find(".product-links>table>tbody>tr").each(function(){var b=a(this).find("input").val(),c=a(this).find(".link-key").text();k[c]=b}),d.details.socialNetworks=k,d}function g(){var c,e=a(".products-table>table");e.find(">tbody>tr").each(function(){var e=a(this).attr("id");c=b.client.getProductDetails(e);var f=c.imagesURLset,g=f.length,i="<div class='images-set'>";if(0!=g)for(var r=0;g>r;r++)i+="<div class='image-item map-item'><a href='#' class='remove-image-item remove-item'>&times</a><img src='"+f[r]+"'></div>";i+="</div><input type='file' id='imagesURLSet-"+e+"-"+g+"'>";for(var s=c.categories,t=s.length,u="",r=0;t>r;r++)u+="<div class='category-item map-item' data-categoryid='"+s[r]+"'><a href='#' class='remove-category-item remove-item'>&times</a>"+d(s[r]).name+"</div>";u+=j;var v=c.optionsMap,w="<table><tbody>";for(var x in v)w+="<tr><td><input type='text' value='"+x+"'></td><td><input type='text' value='"+v[x]+"'></td><td class='td-remove-options'><a href='' class='remove-options-item remove-item'>&times;</a></td></tr>";w+="</tbody></table><a href='#' class='add-options-item add-item'>Добавить</a>";var y=c.socialNetworks,z=a(this).find(".product-links");for(var x in y)"vk"==x?z.find("tr:eq(0) td:eq(1) input").val(y[x]):"fb"==x&&z.find("tr:eq(1) td:eq(1) input").val(y[x]);for(var A,B=a(this).find(".product-producer").data("producerid"),C=k,D=C.length,E="",r=0;D>r;r++)C[r].id==B&&(A=C[r]),E+="<li data-producerid='"+C[r].id+"'><a href='#'>"+C[r].name+"</a></li>";var F="<span>"+A.name+'</span><div class="btn-group producers-dropdown"><button data-toggle="dropdown" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">Изменить</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+E+"</ul></div>",G=a(this);a("#imageURL-"+e).ace_file_input({style:"well",btn_choose:"",btn_change:null,no_icon:"",droppable:!0,icon_remove:null,thumbnail:"large"}).on("change",function(){G.find(".product-imageURL .file-label").css("opacity",1),G.find(".product-imageURL>img").hide()}),a(this).find(".product-fullDescr textarea").val(c.fullDescr),a(this).find(".product-imagesSet").html(i),a("#imagesURLSet-"+e+"-"+g).ace_file_input({style:"well",btn_choose:"Добавить",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var b=a(this);m(e,g,b)}),l(a(this).find(".ace-file-input")),a(this).find(".product-categories").html(u),n(a(this)),o(a(this)),a(this).find(".product-options").html(w),p(a(this)),q(a(this)),a(this).find(".product-producer").html(F),h(a(this))})}function h(b){b.find(".producers-dropdown .dropdown-menu a").click(function(b){b.preventDefault();var c=a(this).text(),d=a(this).closest("li").data("producerid");a(this).closest("td").attr("id",d).find(">span").text(c)})}g(),c.DoubleScroll(document.getElementById("doublescroll-2")),a(".table-add-product .edit-add").click(function(c){c.preventDefault();var d=a(".backoffice.dynamic").attr("id"),f=a(this).closest(".table-add-product").find(".table-overflow>table>tbody>tr"),g=!0,h=e(f,g);h.product.producerId?(a(".error-info").hide(),b.clientBO.registerProduct(h,d),a(this).closest(".table-add-product").slideUp(function(){var b=f.clone();a(".products-table>table>tbody").prepend(b),b.slideDown()})):a(".error-info").text("Вы не указали производителя !").show()}),a(".product-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteProduct(d,e)}),a(".save-products").click(function(c){c.preventDefault(),a(".products-table>table>tbody>.changed").each(function(){var c=a(this),d=!1,f=e(c,d);(void 0===f.imageURL||"../i/no-photo.png"==f.imageURL)&&(f.imageURL=null),b.clientBO.updateProduct(f)})}),a("#edit-product .products-table table tr,#edit-category .category-table tr,#edit-producer .producer-table tr").click(function(){a(this).addClass("changed")}),f=1}function l(b){b.find(".remove").click(function(b){b.preventDefault(),a(this).closest(".ace-file-input").hide().detach()})}function m(b,c,d){if(!d.parent().hasClass("added")){d.parent().addClass("added"),c++;var e="<input type='file' class='new-input' id='imagesURLSet-"+b+"-"+c+"'>";d.parent().after(e),a("#imagesURLSet-"+b+"-"+c).ace_file_input({style:"well",btn_choose:"Добавить",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var d=a(this);m(b,c,d)}),l(d.parent())}}function n(b){b.find(".remove-category-item").click(function(b){b.preventDefault(),a(this).closest(".map-item").fadeOut(200)})}function o(b){b.find(".categories-dropdown .dropdown-menu a").click(function(b){b.preventDefault();var c='<div class="category-item map-item" data-categoryid="'+a(this).closest("li").data("categoryid")+'"><a href="#" class="remove-category-item remove-item">×</a>'+a(this).text()+"</div>";a(this).closest("td").find(".categories-dropdown").before(c),n(a(this).closest("td"))})}function p(b){b.find(".remove-options-item").click(function(b){b.preventDefault(),a(this).closest("tr").slideUp(200,function(){a(this).detach()})})}function q(b){b.find(".add-options-item ").click(function(b){b.preventDefault();var c='<tr><td><input type="text" value=""></td><td><input type="text" value=""></td><td class="td-remove-options"><a href="" class="remove-options-item remove-item">×</a></td></tr>';a(this).closest("td").find("table tbody").append(c),p(a(this).closest("td"))})}function r(){function c(a){var b=a.text(),c=a.closest("li").data("categoryid");a.closest(".category-parent").attr("data-parentid",c).find(".btn-group-text").text(b)}function d(b,c){var d=new com.vmesteonline.be.shop.ProductCategory;return d.id=c?0:b.attr("id"),d.name=b.find(".category-name textarea").val(),d.descr=b.find(".category-descr textarea").val(),d.parentId=b.find(".category-parent").attr("data-parentid"),d.socialNetworks=[],b.find(".category-links table tr").each(function(){var b=a(this).find("input").val(),c=a(this).find(".link-key").text();d.socialNetworks[c]=b}),d}for(var e=a(".backoffice.dynamic").attr("id"),f=b.client.getAllCategories(e),h=f.length,i=[],k=0,l=0;h>l;l++)i[l]=f[l].socialNetworks;i.length&&a(".category-table>tbody>tr").each(function(){var b=i[k];for(var c in b)"vk"==c?a(this).find(".category-links tr:eq(0) td:eq(1) input").val(b[c]):"fb"==c&&a(this).find(".category-links tr:eq(1) td:eq(1) input").val(b[c]);k++}),a(".category-parent").each(function(){if(a(this).html(j),a(this).find(".btn-group-text").text("Выбрать родительскую"),a(this).find(".dropdown-menu a").click(function(b){b.preventDefault(),c(a(this))}),0==a(this).closest(".table-add").length){var b=a(this).data("parentid");a(this).find(".dropdown-menu li").each(function(){a(this).data("categoryid")==b&&c(a(this))})}}),a(".table-add-category .edit-add").click(function(c){c.preventDefault();var e=a(".backoffice.dynamic").attr("id"),f=a(this).closest(".table-add-category").find(">table>tbody>tr"),g=!0,h=d(f,g);a(".error-info").hide(),b.clientBO.registerProductCategory(h,e),a(this).closest(".table-add-category").slideUp(function(){var b=f.clone();a(".category-table>tbody").prepend(b),b.slideDown()})}),a(".save-categories").click(function(c){c.preventDefault(),a(".category-table>tbody>tr.changed").each(function(){var c=a(this),e=!1,f=d(c,e);b.clientBO.updateCategory(f)})}),a(".category-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteCategory(d,e)}),g=1}function s(){function c(b,c){var d=new com.vmesteonline.be.shop.Producer;return d.id=c?0:b.attr("id"),d.name=b.find(".producer-name textarea").val(),d.descr=b.find(".producer-descr textarea").val(),d.socialNetworks=[],b.find(".producer-links table tr").each(function(){var b=a(this).find("input").val(),c=a(this).find(".link-key").text();d.socialNetworks[c]=b}),d}for(var d=(a(".backoffice.dynamic").attr("id"),b.client.getProducers()),e=d.length,f=[],g=0,i=0;e>i;i++)f[i]=d[i].socialNetworks;f.length&&a(".producer-table>tbody>tr").each(function(){var b=f[g];for(var c in b)"vk"==c?a(this).find(".producer-links tr:eq(0) td:eq(1) input").val(b[c]):"fb"==c&&a(this).find(".producer-links tr:eq(1) td:eq(1) input").val(b[c]);g++}),a(".table-add-producer .edit-add").click(function(d){d.preventDefault();var e=a(".backoffice.dynamic").attr("id"),f=a(this).closest(".table-add-producer").find(">table>tbody>tr"),g=!0,h=c(f,g);a(".error-info").hide(),b.clientBO.registerProducer(h,e),a(this).closest(".table-add-producer").slideUp(function(){var b=f.clone();a(".producer-table >tbody").prepend(b),b.slideDown()})}),a(".save-producers").click(function(d){d.preventDefault(),a(".producer-table>tbody>tr.changed").each(function(){var d=a(this),e=!1,f=c(d,e);b.clientBO.updateProducer(f)})}),a(".producer-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteProducer(d,e)}),h=1}f||e(),i||(a(".edit-show-add").click(function(b){b.preventDefault(),a(this).find("+.table-add").slideToggle();var d=a(this).closest(".tab-pane").attr("id");switch(d){case"edit-product":var e=a(".table-add-product table tr");a("#imageURL-add").ace_file_input({style:"well",btn_choose:"",btn_change:null,no_icon:"",droppable:!0,icon_remove:null,thumbnail:"large"}).on("change",function(){e.find(".product-imageURL .file-label").css("opacity",1),e.find(".product-imageURL>img").hide()}),a("#imageURLSet-add").ace_file_input({style:"well",btn_choose:"Добавить изображение",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var b=a(this);m(0,0,b)}),l(a(".table-add-product table .product-imagesSet"));var f=j,g=a(".table-add-product .product-categories");g.html(f),n(g),o(g);var h=a(".table-add-product .table-overflow");c.setDropdownWithoutOverFlow(h.find(".categories-dropdown"),h,84);{var i=a(".table-add-product .product-options");a(".table-add-product .product-links")}p(i),q(i),c.setDropdownWithoutOverFlow(h.find(".producers-dropdown"),h,84),a(this).find("+.table-add .product-producer .dropdown-menu a").click(function(){var b=a(this).parent().data("producerid");a(this).closest("td").attr("data-producerid",b)});break;case"edit-category":break;case"edit-producer":}}),a(".bo-edit .nav-tabs a").click(function(){function b(){c.setSidebarHeight(a(".main-content").height())}var d=a(this).parent().index();switch(d){case 1:g||r();break;case 2:h||s()}setTimeout(b,200)})),i=1}{var f=0,g=0,h=0,i=0;a(".backoffice.dynamic").attr("id")}allCategories="sdf";var j=d(),k=b.client.getProducers();return{initEdit:e,isEditInitSet:i}});