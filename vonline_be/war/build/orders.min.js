define("orders.min",["jquery","shop-initThrift.min","shop-orders.min","bo-common.min","datepicker-backoffice","datepicker-ru"],function(a,b,c,d){function e(){function e(d){d.find(".plus-minus").click(function(d){d.preventDefault();var e=a(this).closest(".order-item"),g=e.find(".order-products");if(0==g.find(".catalog").length){var h=e.data("orderid"),i=b.client.getOrderDetails(h);c.showOrderDetails(e,h,i),g.append(f(i))}g.slideToggle(200,function(){a(".main-content").height()>p.height()&&a("#sidebar, .shop-right").css("height",a(".main-content").height()+45)}),a(this).hasClass("fa-plus")?a(this).removeClass("fa-plus").addClass("fa-minus"):a(this).removeClass("fa-minus").addClass("fa-plus")})}function f(a){try{var c='<section class="catalog"><table><thead><tr><td>Название</td><td>Производитель</td><td>Цена (руб)</td><td>Количество</td><td>Стоимость</td><td>Ед.изм</td><td></td></tr></thead>',d=a.odrerLines,e=d.length;r=r?r:b.client.getProducers(),s=s?s:r.length;for(var f=0;e>f;f++){for(var g,h,i="",j=0;s>j;j++)if(r[j].id==d[f].product.producerId){g=r[j].name,h=r[j].id;break}d[f].product.unitName&&(i=d[f].product.unitName);var k;k=d[f].product.imageURL?d[f].product.imageURL:"/i/no-photo.png",c+='<tr class="product" data-prepack="'+d[f].product.prepackRequired+'" data-productid="'+d[f].product.id+'"><td><a href="#" class="product-link"><span><span class="product-name">'+d[f].product.name+"</span>"+d[f].product.shortDescr+'</span></a><div class="modal"></div></td><td class="td-producer" data-producerid="'+h+'">'+g+'</td><td class="product-price">'+d[f].product.price+'</td><td class="td-spinner">'+d[f].quantity+'</td><td class="orderLine-amount"><span>'+(d[f].product.price*d[f].quantity).toFixed(1)+'</span></td><td><span class="unit-name">'+i+"</span></td></tr>"}c+="</table></section>"}catch(l){alert(l+" Функция createOrdersProductHtml")}return c}function g(a,b){try{var c="",d=a.length,e=0,f=100;b&&(f=lengthOrders,d-=offsetOrders),d>f&&(e=d-f);for(var g=d-1;g>=e;g--){var h,i=new Date(1e3*a[g].date);switch(a[g].status){case 0:h="Неизвестен";break;case 1:h="Не подтвержден";break;case 2:h="Подтвержден";break;case 3:h="Уже едет";break;case 4:h="Доставлен";break;case 5:h="Закрыт";break;case 6:h="Отменен"}var j=i.getDate();j=10>j?"0"+j:j;var k=i.getMonth()+1;k=10>k?"0"+k:k;var l="";"Подтвержден"==h&&(l="passive"),c+='<div class="order-item orders-no-init" data-orderid="'+a[g].id+'"><table class="orders-tbl"><tbody><tr><td class="td1"><a class="fa fa-plus plus-minus" href="#"></a></td><td class="td2">'+a[g].id+'</td><td class="td8 user-name">'+a[g].userName+'</td><td class="td3" id="'+a[g].date+'">'+j+"."+k+"."+i.getFullYear()+'</td><td class="td4"><div class="order-status">'+h+'</div></td><td class="td9"></td><td class="td8"></td><td class="td6">'+a[g].totalCost.toFixed(1)+'</td><td class="td1"><a href="#" title="Удалить заказ" class="delete-order '+l+'">&times;</a></td></tr></tbody></table><div class="order-bottom"><div class="order-delivery"></div></div><div class="order-products"></div></div>'}}catch(m){alert(m+" Функция createOrdersHtml")}return c}function h(a){var b;switch(a){case"Подтвержден":b=2;break;case"Не подтвержден":b=1;break;case"Отменен":b=6}return b}function i(c){for(var e=[],f=0,g=c.length,h=a(".type-delivery-dropdown .btn-group-text").text(),i=d.getDeliveryTypeByText(h),j=0;g>j;j++){var k=b.client.getOrderDetails(c[j].id);i==k.delivery&&(e[f++]=c[j])}return e}function j(){try{var a=u.val().split("-"),b="",c=a[2];switch(a[1]){case"01":b="Jan";break;case"02":b="Feb";break;case"03":b="March";break;case"04":b="Apr";break;case"05":b="May";break;case"06":b="June";break;case"07":b="July";break;case"08":b="Aug";break;case"09":b="Sep";break;case"10":b="Oct";break;case"11":b="Nov";break;case"12":b="Dec"}}catch(d){alert(d+" Функция getMetaDate")}return Date.parse(a[0]+" "+b+" "+c)}function k(a){var b=parseInt(j()/1e3);b-=b%86400,b+=t;for(var c=a.length,d=[],e=0,f=0;c>f;f++)a[f].date==b&&(d[e++]=a[f]);return d}function l(){var b=a(".orders-no-init");e(b),b.removeClass("orders-no-init")}function m(b){var c=0,d=[],e=b.length,f=a(".status-dropdown .btn-group-text").text(),g=h(f);for(D=0;e>D;D++)g==b[D].status&&(d[c++]=b[D]);return d}function n(a){var c=b.client.getOrdersByStatus(0,q+180*t,0),d=o(c,a);return statusFilterFlag&&(d=m(d)),deliveryFilterFlag&&(d=i(d)),dateFilterFlag&&(d=k(d)),searchFilterFlag=1,d}function o(a,b){var c=a.length,d=[];z=0;for(var e=0;c>e;e++)-1!=a[e].userName.toLowerCase().indexOf(b.toLowerCase())&&(d[z++]=a[e]);return d}var p=a(window),q=parseInt((new Date).getTime()/1e3);q-=q%86400;var r,s,t=86400;a(".delete-order").click(function(c){if(c.preventDefault(),!a(this).hasClass("passive")){var d=a(this).closest(".order-item"),e=d.data("orderid");b.client.deleteOrder(e),d.slideUp()}});try{var u=a("#date-picker-1"),v=a(".datepicker-export");globalUserAuth=!0,u.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()}),v.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()});var w={createOrdersHtml:g,initOrderPlusMinus:e,setSidebarHeight:d.setSidebarHeight,filterByStatus:m,filterByDelivery:i,filterBySearch:o};u.datepicker("setVarOrderDates",w),v.datepicker("setVarOrderDates",w),a(".reset-filters").click(function(){deliveryFilterFlag=0,statusFilterFlag=0,dateFilterFlag=0,searchFilterFlag=0,a(".orders-list").html(""),a(".type-delivery-dropdown .btn-group-text").text("Тип доставки"),a(".status-dropdown .btn-group-text").text("Статус заказа"),a("#back-search").val("Поиск по имени клиента или номеру телефона"),u.val("Фильтр по дате")})}catch(x){}a("#date-picker-2,#date-picker-3,#date-picker-4").val("Фильтр по дате"),a(".export .checkbox input.ace").prop("checked",!1),a(".status-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=a(this).find("a").text(),e=h(d),f=b.client.getOrdersByStatus(0,q+180*t,e);deliveryFilterFlag&&(f=i(f),alert(f.length)),searchFilterFlag&&(f=o(f,a("#back-search").val())),dateFilterFlag&&(f=k(f)),a(".orders-list").html("").append(g(f)),l(),statusFilterFlag=1}),a(".type-delivery-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=b.client.getOrdersByStatus(0,q+180*t,0),e=i(d);statusFilterFlag&&(e=m(e)),searchFilterFlag&&(e=o(e,a("#back-search").val())),dateFilterFlag&&(e=k(e)),a(".orders-list").html("").append(g(e)),l(),deliveryFilterFlag=1});var y=[],z=0;a(".back-orders .order-item").each(function(){y[z++]=a(this).find(".user-name").text()});var A=y.length,B=[],C=0;z=0;for(var D=0;A-1>D;D++){C=0;for(var E=D+1;A>E;E++)y[D]==y[E]&&(C=1);C||(B[z++]=y[D])}B[z]=y[A-1],a("#back-search").focus(function(){a(this).autocomplete({source:B,select:function(b,c){a(".orders-list").html("").append(g(n(c.item.label))),l()}})}),a(".search-form").submit(function(b){b.preventDefault();var c=a("#back-search").val();a(".orders-list").html("").append(g(n(c))),l()})}return{initBackofficeOrders:e}});