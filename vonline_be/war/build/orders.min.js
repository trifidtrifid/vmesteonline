define("orders.min",["jquery","shop-initThrift.min","shop-orders.min","bo-common.min","datepicker-backoffice","datepicker-ru"],function(a,b,c,d){function e(){function e(){try{orders=b.client.getOrdersByStatus(0,r+180*s,0),a(".orders-list").html("").append(h(orders));var c=a(".orders-no-init");f(c),c.removeClass("orders-no-init"),deliveryFilterFlag=0,statusFilterFlag=0,dateFilterFlag=0,searchFilterFlag=0}catch(d){}}function f(d){d.find(".plus-minus").click(function(d){d.preventDefault();var e=a(this).closest(".order-item"),f=e.find(".order-products");if(0==f.find(".catalog").length){var h=e.data("orderid"),i=b.client.getOrderDetails(h);c.showOrderDetails(e,h,i),f.append(g(i))}f.slideToggle(200,function(){a(".main-content").height()>q.height()&&a("#sidebar, .shop-right").css("height",a(".main-content").height()+45)}),a(this).hasClass("fa-plus")?a(this).removeClass("fa-plus").addClass("fa-minus"):a(this).removeClass("fa-minus").addClass("fa-plus")})}function g(a){try{var c='<section class="catalog"><table><thead><tr><td>Название</td><td>Производитель</td><td>Цена (руб)</td><td>Количество</td><td>Стоимость</td><td>Ед.изм</td><td></td></tr></thead>',d=a.odrerLines,e=d.length;t=t?t:b.client.getProducers(),u=u?u:t.length;for(var f=0;e>f;f++){for(var g,h,i="",j=0;u>j;j++)if(t[j].id==d[f].product.producerId){g=t[j].name,h=t[j].id;break}d[f].product.unitName&&(i=d[f].product.unitName);var k;k=d[f].product.imageURL?d[f].product.imageURL:"../i/no-photo.png",c+='<tr class="product" data-prepack="'+d[f].product.prepackRequired+'" data-productid="'+d[f].product.id+'"><td><a href="#" class="product-link"><div class="product-pic"><img src="'+k+'" alt="картинка"/></div><span><span class="product-name">'+d[f].product.name+"</span>"+d[f].product.shortDescr+'</span></a><div class="modal"></div></td><td class="td-producer" data-producerid="'+h+'">'+g+'</td><td class="product-price">'+d[f].product.price+'</td><td class="td-spinner">'+d[f].quantity+'</td><td class="orderLine-amount"><span>'+(d[f].product.price*d[f].quantity).toFixed(1)+'</span></td><td><span class="unit-name">'+i+"</span></td></tr>"}c+="</table></section>"}catch(l){alert(l+" Функция createOrdersProductHtml")}return c}function h(a,b){try{var c="",d=a.length,e=0,f=100;b&&(f=lengthOrders,d-=offsetOrders),d>f&&(e=d-f);for(var g=d-1;g>=e;g--){var h,i=new Date(1e3*a[g].date);switch(a[g].status){case 0:h="Неизвестен";break;case 1:h="Не подтвержден";break;case 2:h="Подтвержден";break;case 3:h="Уже едет";break;case 4:h="Доставлен";break;case 5:h="Закрыт";break;case 6:h="Отменен"}var j=i.getDate();j=10>j?"0"+j:j;var k=i.getMonth()+1;k=10>k?"0"+k:k;var l="";"Подтвержден"==h&&(l="passive"),c+='<div class="order-item orders-no-init" data-orderid="'+a[g].id+'"><table class="orders-tbl"><tbody><tr><td class="td1"><a class="fa fa-plus plus-minus" href="#"></a></td><td class="td2">'+a[g].id+'</td><td class="td8 user-name">'+a[g].userName+'</td><td class="td3" id="'+a[g].date+'">'+j+"."+k+"."+i.getFullYear()+'</td><td class="td4"><div class="order-status">'+h+'</div></td><td class="td9"></td><td class="td8"></td><td class="td6">'+a[g].totalCost.toFixed(1)+'</td><td class="td1"><a href="#" title="Удалить заказ" class="delete-order '+l+'">&times;</a></td></tr></tbody></table><div class="order-bottom"><div class="order-delivery"></div></div><div class="order-products"></div></div>'}}catch(m){alert(m+" Функция createOrdersHtml")}return c}function i(a){var b;switch(a){case"Подтвержден":b=2;break;case"Не подтвержден":b=1;break;case"Отменен":b=6}return b}function j(c){for(var e=[],f=0,g=c.length,h=a(".type-delivery-dropdown .btn-group-text").text(),i=d.getDeliveryTypeByText(h),j=0;g>j;j++){var k=b.client.getOrderDetails(c[j].id);i==k.delivery&&(e[f++]=c[j])}return e}function k(){try{var a=v.val().split("-"),b="",c=a[2];switch(a[1]){case"01":b="Jan";break;case"02":b="Feb";break;case"03":b="March";break;case"04":b="Apr";break;case"05":b="May";break;case"06":b="June";break;case"07":b="July";break;case"08":b="Aug";break;case"09":b="Sen";break;case"10":b="Oct";break;case"11":b="Nov";break;case"12":b="Dec"}}catch(d){alert(d+" Функция getMetaDate")}return Date.parse(a[0]+" "+b+" "+c)}function l(a){var b=parseInt(k()/1e3);b-=b%86400,b+=s;for(var c=a.length,d=[],e=0,f=0;c>f;f++)a[f].date==b&&(d[e++]=a[f]);return d}function m(){var b=a(".orders-no-init");f(b),b.removeClass("orders-no-init")}function n(b){var c=0,d=[],e=b.length,f=a(".status-dropdown .btn-group-text").text(),g=i(f);for(E=0;e>E;E++)g==b[E].status&&(d[c++]=b[E]);return d}function o(a){var c=b.client.getOrdersByStatus(0,r+180*s,0),d=p(c,a);return statusFilterFlag&&(d=n(d)),deliveryFilterFlag&&(d=j(d)),dateFilterFlag&&(d=l(d)),searchFilterFlag=1,d}function p(a,b){var c=a.length,d=[];A=0;for(var e=0;c>e;e++)-1!=a[e].userName.toLowerCase().indexOf(b.toLowerCase())&&(d[A++]=a[e]);return d}var q=a(window),r=parseInt((new Date).getTime()/1e3);r-=r%86400;var s=86400;e();var t,u;a(".delete-order").click(function(c){if(c.preventDefault(),!a(this).hasClass("passive")){var d=a(this).closest(".order-item"),e=d.data("orderid");b.client.deleteOrder(e),d.slideUp()}});try{var v=a("#date-picker-1"),w=a(".datepicker-export");globalUserAuth=!0,v.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()}),w.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()});var x={createOrdersHtml:h,initOrderPlusMinus:f,setSidebarHeight:d.setSidebarHeight,filterByStatus:n,filterByDelivery:j,filterBySearch:p};v.datepicker("setVarOrderDates",x),w.datepicker("setVarOrderDates",x),a(".reset-filters").click(function(){e(),a(".type-delivery-dropdown .btn-group-text").text("Тип доставки"),a(".status-dropdown .btn-group-text").text("Статус заказа"),a("#back-search").val("Поиск по имени клиента или номеру телефона"),v.val("Фильтр по дате")})}catch(y){}a("#date-picker-2,#date-picker-3,#date-picker-4").val("Фильтр по дате"),a(".export .checkbox input.ace").prop("checked",!1),a(".status-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=a(this).find("a").text(),e=i(d),f=b.client.getOrdersByStatus(0,r+180*s,e);deliveryFilterFlag&&(f=j(f)),searchFilterFlag&&(f=p(f,a("#back-search").val())),dateFilterFlag&&(f=l(f)),a(".orders-list").html("").append(h(f)),m(),statusFilterFlag=1}),a(".type-delivery-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=b.client.getOrdersByStatus(0,r+180*s,0),e=j(d);statusFilterFlag&&(e=n(e)),searchFilterFlag&&(e=p(e,a("#back-search").val())),dateFilterFlag&&(e=l(e)),a(".orders-list").html("").append(h(e)),m(),deliveryFilterFlag=1});var z=[],A=0;a(".back-orders .order-item").each(function(){z[A++]=a(this).find(".user-name").text()});var B=z.length,C=[],D=0;A=0;for(var E=0;B-1>E;E++){D=0;for(var F=E+1;B>F;F++)z[E]==z[F]&&(D=1);D||(C[A++]=z[E])}C[A]=z[B-1],a("#back-search").focus(function(){a(this).autocomplete({source:C,select:function(b,c){a(".orders-list").html("").append(h(o(c.item.label))),m()}})}),a(".search-form").submit(function(b){b.preventDefault();var c=a("#back-search").val();a(".orders-list").html("").append(h(o(c))),m()})}return{initBackofficeOrders:e}});