define("shop-common",["jquery","flexslider","shop-initThrift","shop-basket","shop-spinner","shop-orders","shop-category","bootstrap"],function(a,b,c,d,e){function f(a){try{var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"))}catch(c){alert(c+" Функция getCookie")}return b?decodeURIComponent(b[1]):void 0}function g(a,b,c){try{c=c||{};var d=c.expires;if("number"==typeof d&&d){var e=new Date;e.setTime(e.getTime()+1e3*d),d=c.expires=e}d&&d.toUTCString&&(c.expires=d.toUTCString()),b=encodeURIComponent(b);var f=a+"="+b;for(var g in c){f+="; "+g;var h=c[g];h!==!0&&(f+="="+h)}document.cookie=f}catch(i){alert(i+" Функция setCookie")}}function h(a,b){var d=b?b:c.client.getOrderDetails(a);return(d.weightGramm/1e3).toFixed(1)}function i(b,d){for(var e,f=c.userClient.getCounties(),g=f.length,h=d?d.country.name:b.find(".country-delivery").val(),i=0,j=0;g>j;j++)f[j].name==h&&(e=f[j],i=e.id);i||(e=c.userClient.createNewCountry(h),i=e.id);var k,l=c.userClient.getCities(i),m=l.length,n=d?d.city.name:b.find(".city-delivery").val(),o=0;for(j=0;m>j;j++)l[j].name==n&&(k=l[j],o=k.id);o||(k=c.userClient.createNewCity(i,n),o=k.id);var p,q=c.userClient.getStreets(o),r=q.length,s=d?d.street.name:b.find(".street-delivery").val(),t=0;for(j=0;r>j;j++)q[j].name==s&&(p=q[j],t=p.id);t||(p=c.userClient.createNewStreet(o,s),t=p.id);var u,v=c.userClient.getBuildings(t),w=v.length,x=d?d.building.fullNo:b.find(".building-delivery").val(),y=0;for(j=0;w>j;j++)v[j].fullNo==x&&(u=v[j],y=u.id);y||(u=c.userClient.createNewBuilding(t,x),y=u.id);var z=new com.vmesteonline.be.PostalAddress;return z.country=e,z.city=k,z.street=p,z.building=u,z.staircase=0,z.floor=0,z.flatNo=parseInt(d?d.flatNo:b.find(".flat-delivery").val()),z.comment=a("#order-comment").val(),z}function j(){var b=parseInt((new Date).getTime()/1e3);b-=b%86400;for(var e=86400,f=c.client.getMyOrdersByStatus(b,b+90*e,1),g=f.length,i=0;g>i;i++){var j=f[i].id,k=c.client.getOrderDetails(j);console.log("reload before addTabToBasketHtml"),d.addTabToBasketHtml(f[i].date,j,k),console.log("reload after addTabToBasketHtml"),a(".tab-pane.active").find(".weight span").text(h(j,k));for(var l=k.odrerLines,m=k.odrerLines.length,n=0;m>n;n++){var o,p=l[n].packs,r=0;for(var t in p)p[t]>1&&(r=1);o=s(p)>1||r?!0:!1,d.AddSingleProductToBasket(l[n].product,l[n].quantity,o,k)}}q();var u=a(window).height()-a(".navbar").height()-a("footer").height();a(".catalog-order").css("max-height",u-215)}function k(b){b.click(function(b,f){b.preventDefault();var g,h=a(this).closest(".order-products").length?!0:!1,i=a(this).closest(".catalog").length&&!h?!0:!1,j=a(this).closest(".catalog-confirm").length?!0:!1,k=a(this).closest(".catalog-order").length||j?!0:!1,m=a(this).closest(".product"),p=a(this).find(".product-name").text(),q=m.data("productid"),r=a(this).find("img").attr("src").split("?"),s={name:p,price:m.find(".product-price").text(),unitName:m.find(".unit-name").text(),imageURL:r[0],producerName:m.find(".td-producer").text(),producerId:m.find(".td-producer").data("producerid")};if("undefined"==s.producerName){g=c.client.getProducers();for(var t=g.length,u=0;t>u;u++)s.producerId==g[u].id&&(s.producerName=g[u].name)}var v=a(this).find("+.modal"),w=v.find(".modal-body").length,x=m.data("prepack");if(w){if(k||h)x&&(R=!1,e.initPrepackRequiredInModal(a(this),v,m,R));else if(x){var y;y=m.hasClass("added")?0:v.find(".prepack-line").length}}else{var A,B=c.client.getProductDetails(q),C=B.imagesURLset,D=B.optionsMap,E=B.socialNetworks,F="";for(var G in E)""!=E[G]&&(A=E[G],-1!=A.indexOf("vk")?F+="<a href='"+A+"'><img src='../i/vk.png'></a>":-1!=A.indexOf("fb")&&(F+="<a href='"+A+"'><img src='../i/fb.png'></a>"));g||(g=c.client.getProducers());for(var H,I,J=g.length,K="",L=0;J>L;L++)if(g[L].id==s.producerId&&(H=g[L].socialNetworks)){I=H.length;for(var M in H)-1!=H[M].indexOf("vk")?K+="<a href='"+H[M]+"'><img src='../i/vk.png'></a>":-1!=H[M].indexOf("fb")&&(K+="<a href='"+H[M]+"'><img src='../i/fb.png'></a>")}C.length&&v.height("275px"),x&&v.addClass("modal-with-prepack");var N=m.find(".td-spinner .spinner1").data("step"),O="";if(O+='<div class="modal-body"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><div class="product-slider"><div class="slider flexslider"><ul class="slides"><li><img src="'+s.imageURL+'" /></li>',C.length)for(var u=0;u<C.length;u++)O+='<li><img src="'+C[u]+'" /></li>';if(O+="</ul></div>",C.length){for(O+='<div class="carousel flexslider"><ul class="slides"><li><img src="'+s.imageURL+'" /></li>',u=0;u<C.length;u++)O+='<li><img src="'+C[u]+'" /></li>';O+="</ul></div>"}O+='</div><div class="product-descr"><h3>'+s.name+"</h3>",F.length&&(O+='<span class="product-soc-links">'+F+"</span>"),O+='<div class="modal-producer">Производитель: '+s.producerName+'<span class="producer-soc-links">'+K+'</span></div><div class="product-text"><div class="product-options">',!x&&s.weight&&(O+="<span>Вес: "+s.weight+"</span>"),x&&s.minClientPack&&(O+="<span>Мин.упаковка: "+s.minClientPack+"</span>");for(var G in D)O+="<div>"+G+" "+D[G]+"</div>";O+="</div>",O+=x?'<div class="modal-footer with-prepack"><span>Цена: '+s.price+'</span><div class="prepack-item packs"><input type="text" class="input-mini spinner1 prepack" /><span>упаковок</span></div><div class="prepack-item">по</div><div class="prepack-item qnty"><input type="text" data-step="'+N+'" class="input-mini spinner1" /><span>'+s.unitName+'</span></div><div class="prepack-item"><a href="#" title="Добавить" class="fa fa-plus prepack-open"></a></div>':'<div class="modal-footer"><span>Цена: '+s.price+'</span><div class="prepack-item"><input type="text" class="input-mini spinner1" /><span>'+s.unitName+"</span></div>",O+='<a href="#" title="Добавить в корзину" class="fa fa-shopping-cart"></a>',O+='<div class="prepack-list"></div><br><div class="error-info error-prepack"></div>',B.fullDescr&&(O+='<a href="#" class="btn btn-primary btn-sm no-border full-descr">Подробное описание</a><div class=\'product-fullDescr\'>'+B.fullDescr+"</div>"),O+="</div></div></div>",v.append(O),B.fullDescr||v.addClass("withoutFullDescr");var P,Q;if(k||h){if(x){var R=!0;e.initPrepackRequiredInModal(a(this),v,m,R,k)}else P=m.find(".ace-spinner").spinner("value"),Q=m.find(".td-spinner .spinner1").data("step"),e.InitSpinner(v.find(".spinner1"),P,k,Q);h&&d.InitAddToBasket(v.find(".fa-shopping-cart"))}else P=m.find(".ace-spinner").spinner("value"),x?(e.InitSpinner(v.find(".packs .spinner1"),1),e.InitSpinner(v.find(".qnty .spinner1"),P,0,N)):e.InitSpinner(v.find(".spinner1"),P,0,N),d.InitAddToBasket(v.find(".fa-shopping-cart"));var S={isBasket:k,productSelector:m,productId:q};n(v,S),o(v),k&&v.find(".fa-shopping-cart").click(function(){var b=a(".tab-pane.active").data("orderid"),c=!0,d=e.singleSetOrderLine(m,b,q,c);if(!d.errorFlag){var f=a(this).closest(a(this).closest(".catalog-order").length?".catalog-order":".catalog-confirm");e.updateWeightAndAmount(b,f,d.updateInfo),v.modal("hide"),a(".basket-backdrop").hide()}return!1}),v.find(".close").click(function(b,c){!c&&i&&l(V),a(".basket-backdrop").hide()})}var T="p",U=document.location.hash;if(!f&&i){var V={type:"modal",productid:q};window.history.pushState(V,null,U+"#"+T+"="+q)}v.modal(),k&&!j&&(a(".modal-backdrop").hide(),a(".modal-backdrop.basket-backdrop").show()),z=v.find(".product-fullDescr").height(),v.find(".product-fullDescr").hide();var W=v.find(".product-text").height(),X=v.find(".product-descr h3").height(),Y=v.find(".modal-footer").height(),Z=Y+X+W+60;Z>230&&v.height(Z),a(".modal-backdrop").click(function(){i&&l(V),a(".modal.in .close").trigger("click"),a(this).hide()});var $=v.find(".carousel"),_=v.find(".slider");$.flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:60,itemMargin:5,asNavFor:_}),_.flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,sync:$})})}function l(a){var b=document.location.hash.split("#");b.pop(),b=b.join("#"),""==b&&(b=" "),window.history.replaceState(a,null,b)}function m(b,c){var d=c?c:!1;a(".catalog .product").each(function(){a(this).data("productid")==b&&a(this).find(".product-link").trigger("click",[d])})}function n(b,c){b.find(".prepack-open").click(function(b){b.preventDefault();var d=a(this).closest(".modal-footer").find(">.qnty .spinner1").data("step"),f=c.isBasket,g=c.productSelector,h=c.productId,i='<div class="prepack-line no-init"><div class="prepack-item packs"><input type="text" class="input-mini spinner1 prepack" /><span>упаковок</span></div><div class="prepack-item">по</div><div class="prepack-item qnty"><input type="text" data-step="'+d+'" class="input-mini spinner1" /><span>'+a(this).closest(".prepack-item").prev().find("span").text()+'</span></div><div class="prepack-item"><a href="#" class="remove-prepack-line" title="Удалить">×</a></div></div>';a(this).closest(".modal-footer").find(".prepack-list").append(i);var j=a(".prepack-line.no-init");e.InitSpinner(j.find(".packs .spinner1"),1,f),e.InitSpinner(j.find(".qnty .spinner1"),d,f,d),e.initRemovePrepackLine(j.find(".prepack-item .remove-prepack-line"),h,g),j.removeClass("no-init");var k=a(this).closest(".modal").height();a(this).closest(".modal").height(k+53)})}function o(b){b.find(".full-descr").click(function(b){b.preventDefault();var c,d=a(".product-fullDescr");c=a(this).closest(".modal").height();var e;"none"==d.css("display")?(e=c+z,a(this).closest(".modal").height(e),d.show(0)):(e=c-z,d.hide(0,function(){a(this).closest(".modal").height(e)}))})}function p(b,d){var e=a(".tab-pane.active").data("orderid"),f=d?d:c.client.getOrderDetails(e),g=f.totalCost;return g||(g=0,b.find(".td-summa").each(function(){g+=parseFloat(a(this).text())})),g+=f.deliveryCost,g.toFixed(1)}function q(){var b,c=a(".catalog tr"),d=a(".tabs-days .tab-content .catalog-order li"),e=d.length;c.each(function(){for(var c=0;e>c;c++)b=d.eq(c).data("productid"),a(this).data("productid")==b&&a(this).addClass("added")})}function r(){var b,c=a(".catalog tr.added"),d=a(".tabs-days .tab-content .catalog-order li"),e=d.length;c.each(function(){for(var c=0;e>c;c++)b=d.eq(c).data("productid"),a(this).data("productid")==b&&a(this).removeClass("added")})}function s(a){var b=0;for(var c in a)c&&a[c]&&b++;return b}function t(){var b=a(".main-content");b.height()>a(window).height()-45?a(".shop-right").css("height",b.height()+45):a(".shop-right").css("height","100%")}function u(){var b=a(".modal.in");b.length&&b.modal("hide");var c=a(".modal-auth");c.load("../login.jsp .login-container",function(){var b='<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>';c.find(".reg-form").prepend(b),a.ajax({url:"../js/shop/login.js",dataType:"script"}),a(this).hover(function(){a(".login-close").removeClass("hide")},function(){a(".login-close").addClass("hide")})}).modal()}function v(a){return/^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/.test(a)}function w(b){var d=b?b:c.userClient.getShortUserInfo(),e=d.firstName+" "+d.lastName;a(".user-info").html(e);var f=a(".shop.dynamic").attr("id"),g=c.client.getUserShopRole(f);1!=g&&a(".navbar-header .nav .bo-link").removeClass("hidden")}function x(){a(".no-active-shops li").each(function(){var b=a(this).attr("id"),d=c.client.getVotes(b);a(this).find(".voice-counter").text(0);for(var e in d)a(this).find(".voice-counter").text(d[e]);var f=c.clientBO.getShopPages(b);f.aboutPageContentURL||a(this).find(">a").addClass("disable-link")}),a(".disable-link").click(function(a){a.preventDefault()}),a(".vote-btn").click(function(b){if(b.preventDefault(),globalUserAuth){var d=a(this).closest("li"),e=d.find(".voice-counter"),f=d.attr("id"),g=e.text();c.client.canVote(f)?(c.client.vote(f,"1"),e.text(++g)):(d.find(".error-info").text("Вы уже голосовали !").show(),setTimeout(function(){d.find(".error-info").hide()},2e3))}else a(".landing-login").trigger("click")})}function y(){var b=a(".shop.dynamic").attr("id"),d=c.clientBO.getShopPages(b);a(".shop-about").load(d.aboutPageContentURL+" .about",function(){})}var z,A="/i/no-photo.png";return a(".shop-trigger").click(function(b){(!a(".backoffice").length&&!a(".page-about-shop").length||a(this).hasClass("go-to-orders"))&&b.preventDefault();var d,e=a(".shop-orders"),f=a(".shop-orders .orders-list");if(a(this).hasClass("back-to-shop")){a(".page").hide(),a("footer").addClass("short-footer"),e.hide(),a(".shop-confirm").hide(),a(".main-container-inner").show(),a(".navbar .nav li.active").removeClass("active"),a(this).addClass("active");var g=a(".shop-products");if(g.find(".shop-menu .shopmenu-back").length){var h=require("shop-category");h.InitLoadCategory(0)}g.show(function(){t()}),d={type:"default"},window.history.pushState(d,null," ")}else if(a(this).hasClass("go-to-orders")){var i=require("shop-orders");if(globalUserAuth){var j=document.location.hash;if("#orders-history"!=j){d={type:"page",pageName:"orders-history"};var l;l=-1==j.indexOf("#")?j:"",window.history.pushState(d,null,l+"#"+d.pageName)}a(".page").hide(),a("footer").addClass("short-footer"),a(".shop-products").hide(),a(".shop-confirm").hide(),a(".shop-page").show();var m=parseInt((new Date).getTime()/1e3);m-=m%86400;var n=86400,o=c.client.getMyOrdersByStatus(0,m+90*n,0);i.initVarForMoreOrders(),f.html("").append(i.createOrdersHtml(o)),k(a(".shop-orders .product-link")),i.initShowMoreOrders(o),i.deleteOrderFromHistory();var p=a(".orders-no-init");i.initOrderPlusMinus(p),i.initOrderBtns(p),p.removeClass("orders-no-init"),e.show(),t()}else{var r=require("shop-basket");r.callbacks.add(i.GoToOrdersTrigger),u()}}q()}),a(".user-short a.dropdown-toggle").click(function(b){b.preventDefault(),a(this).hasClass("no-login")?u():a(this).closest(".navbar").toggleClass("over-rightbar")}),a("html,body").click(function(){a(".user-short").hasClass("open")&&(a(".navbar").removeClass("over-rightbar"),a(".user-short").removeClass("open"))}),{getCookie:f,setCookie:g,noPhotoPic:A,initBasketInReload:j,InitProductDetailPopup:k,countAmount:p,getPacksLength:s,setSidebarHeight:t,openModalAuth:u,markAddedProduct:q,remarkAddedProduct:r,addAddressToBase:i,isValidEmail:v,changeShortUserInfo:w,getOrderWeight:h,identificateModal:m,initLanding:x,initShopAbout:y}});