define("commonM.min",["jquery","shop-initThrift.min","shop-search.min","shop-common.min"],function(a,b,c,d){function e(){function e(){var c=document.location.hash;if("#edit-profile"!=c){var d={type:"page",pageName:"edit-profile"};window.history.pushState(d,null,"shop.jsp#"+d.pageName)}a(".save-changes").click(function(c){function d(){a(".save-status").removeClass("active"),a(".shop-editPersonal").hide(),a(".user-menu li:eq(0) a").trigger("click")}c.preventDefault();var e=a(".error-info");e.hide();var f=a("#edit-email"),g=a("#edit-phone"),h=a("#edit-name").val(),i=a("#edit-surname").val(),j=f.val(),k=g.val(),l=b.userClient.getUserInfo(),m=b.userClient.getUserContacts(),n=0;l.firstName=h,l.lastName=i,m.mobilePhone=k;var o=require("shop-common.min");o.isValidEmail(j)?m.email=j:(n=1,f.find("+.error-info").text("Некорректный email").show());try{b.userClient.updateUserContacts(m)}catch(c){n=1,g.find("+.error-info").text("Телефон должен быть вида 79219876543, +7(821)1234567 и т.п").show()}n||(b.userClient.updateUserInfo(l),a(".save-status").addClass("active"),o.changeShortUserInfo(l),setTimeout(d,2e3))}),a(".main-container").css("min-height",j.height()-115)}function f(d){if(a(".edit-personal-link").click(function(b){b.preventDefault(),a(".page").hide(),a(".shop-editPersonal").load("ajax/ajax-editPersonal.jsp .dynamic",function(){a(".loading").show(0),e(),a(".loading").hide(0)}).show()}),d)a(".edit-personal-link").trigger("click");else{a("footer").removeClass("short-footer");var f=document.location.hash;if("#profile"!=f){var j={type:"page",pageName:"profile"};window.history.pushState(j,null,"shop.jsp#"+j.pageName)}a(".main-container").css("min-height",a(window).height()-115),a(".sendConfirmCode").click(function(c){c.preventDefault();var d=b.userClient.getUserContacts().email,e="mailTemplates/changePasswordConfirm.html";b.authClient.sendConfirmCode(d,e),a(".confirm-info").text("На ваш e-mail отправлен код").addClass("info-good").show()}),a(".useConfirmCode").click(function(c){function d(){a(".account-no-confirm").slideUp(),a(".confirm-alert").hide()}c.preventDefault();var e=b.userClient.getUserContacts().email,f=a("#confirmCode").val(),g=a(".confirm-info");try{b.authClient.confirmRequest(e,f),g.text("Код принят !").addClass("info-good").show(),setTimeout(d,4e3)}catch(c){g.text("Неверный код подтверждения !").removeClass("info-good").show()}});var k=b.client.getUserDeliveryAddresses().elems,l=k.length;if(l>0){for(var m,n="",o=0;l>o;o++)m=b.client.getUserDeliveryAddress(k[o]),n+='<div class="user-address-item" data-index="'+o+'"><span>'+m.street.name+" "+m.building.fullNo+", кв. "+m.flatNo+'</span><a href="#" class="edit-user-addr">редактировать</a><a href="#" title="Удалить" class="remove-user-addr">&times;</a></div>';a(".user-addresses").prepend(n),i(a(".edit-user-addr").parent(),k)}var p=a(".form-edit-wrap").html();a(".add-user-address").click(function(b){b.preventDefault();var d=a(this).find("+.form-edit");0==d.length?(a(this).after(p),g(d),d=a(this).find("+.form-edit"),d.slideDown(200),h(d),c.initAutocompleteAddress(d)):"block"==d.css("display")?d.slideUp(200):d.slideDown(200)})}}function g(a,b){b?(a.find(".country-delivery").val(b.country.name),a.find(".city-delivery").val(b.city.name),a.find(".street-delivery").val(b.street.name),a.find(".building-delivery").val(b.building.fullNo),a.find(".flat-delivery").val(b.flatNo)):(a.find(".country-delivery").val(""),a.find(".city-delivery").val(""),a.find(".street-delivery").val(""),a.find(".building-delivery").val(""),a.find(".flat-delivery").val(""))}function h(c,d){c.find(".save-new-addr").click(function(c){c.preventDefault();var e=a(this).closest(".form-edit");e.prev().find(".edit-user-addr").text("редактировать");var f=parseInt(e.find(".flat-delivery").val());if(f){e.find(".error-info").hide();var g,h=require("shop-common.min"),j=e.find(".street-delivery").val(),k=e.find(".building-delivery").val(),l=!1;if(e.prev().hasClass("add-user-address"))try{g=b.client.createDeliveryAddress(j+" "+k,f,0,0,0),e.find(".error-info").hide();var m=a(".user-address-item").length;m||(m=1);var n='<div class="user-address-item no-init" data-index="'+m+'"><span>'+g.street.name+" "+g.building.fullNo+", кв. "+g.flatNo+'</span><a href="#" class="edit-user-addr">редактировать</a><a href="#" title="Удалить" class="remove-user-addr">&times;</a></div>';a(".user-addresses").prepend(n);var o=b.client.getUserDeliveryAddresses().elems,p=a(".user-address-item.no-init");i(p,o,g),p.removeClass("no-init")}catch(c){l=!0,e.find(".error-info").text("Такого адреса не существует !").show()}else try{g=b.client.createDeliveryAddress(j+" "+k,f,0,0,0),e.find(".error-info").hide(),e.prev().find("span").text(g.street.name+" "+g.building.fullNo+", кв. "+g.flatNo),d&&b.client.deleteDeliveryAddress(d.street.name+" "+d.building.fullNo)}catch(c){l=!0,e.find(".error-info").text("Такого адреса не существует !").show()}l||(h.addAddressToBase(e,g),e.slideUp())}else e.find(".error-info").text("Номер квартиры должен быть числом !").show()})}function i(e,f,i){var j=a(".form-edit-wrap").html();e.find(".edit-user-addr").click(function(e){e.preventDefault(),a(".form-edit-wrap").remove();var k=i,l=a(this).closest(".user-address-item");if(0==l.find("+.form-edit").length){l.after(j);var m=l.find("+.form-edit"),n=l.data("index");i||(k=b.client.getUserDeliveryAddress(f[n])),g(m,k);var o=d.addAddressToBase(m);h(m,o),c.initAutocompleteAddress(m)}l.find("+.form-edit").slideToggle(200,function(){var b=a(this).prev().find(".edit-user-addr");b.text("block"==l.find("+.form-edit").css("display")?"отменить":"редактировать")})}),e.find(".remove-user-addr").click(function(c){c.preventDefault();var d=a(this).closest(".user-address-item");d.slideUp(function(){var c,d=a(this).data("index");c=i?i:f[d],b.client.deleteDeliveryAddress(c)}),d.find("+.form-edit").slideUp()})}var j=a(window),k=a("#sidebar"),l=a(".show-left"),m=(j.height()-l.width())/2;l.css("top",m),k.css("min-height",j.height()),l.click(function(){a(this).hasClass("active")?(a(this).parent().animate({marginLeft:"-190px"},200),a(this).animate({marginLeft:"0"},200).removeClass("active")):(a(this).animate({"margin-left":"190px"},200).addClass("active"),a(this).parent().animate({marginLeft:0},200))}),a(".dropdown-menu li a").click(function(b){b.preventDefault(),a(this).closest(".btn-group").find(".btn-group-text").text(a(this).text())}),a('.nav-list a,.navbar .nav a:not(".dropdown-toggle")').click(function(b){var c=a(this).closest(".backoffice").length;c||a(this).hasClass("bo-link")||a(this).hasClass("main-page-link")||b.preventDefault(),a(this).closest("ul").find(".active").removeClass("active"),a(this).parent().addClass("active")}),a(".user-menu a").click(function(c,d){c.preventDefault();var e=d?d:!1;a(".navbar .nav .active").removeClass("active"),a(this).closest(".user-short").removeClass("open"),c.stopPropagation();var g=a(this).parent().index();0==g?(a(".page").hide(),a(".shop-profile").load("ajax/ajax-profile.jsp .dynamic",function(){f(e)}).show()):(b.authClient.logout(),document.location.replace("login.jsp"))}),a(".user-short .dropdown-toggle.no-login").click(function(){a(this).parent().addClass("open")}),d.setSidebarHeight()}return{init:e}});