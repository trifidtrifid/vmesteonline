require.config({baseUrl:"/build",paths:{jquery:"../js/lib/jquery-2.1.1.min",bootstrap:"../js/lib/bootstrap.min",ace_extra:"../js/lib/ace-extra.min",ace_elements:"../js/lib/ace-elements.min",jquery_ui:"../js/lib/jquery-ui-1.10.3.full.min",flexslider:"../js/lib/jquery.flexslider-min",ace_spinner:"../js/lib/fuelux/fuelux.spinner","datepicker-backoffice":"../js/bootstrap-datepicker-backoffice","datepicker-ru":"../js/lib/date-time/locales/bootstrap-datepicker.ru",multiselect:"../js/lib/jquery.multiselect.min",bootbox:"../js/bootbox.min"},shim:{ace_spinner:{deps:["jquery","ace_extra","ace_elements","jquery_ui"],exports:"ace_spinner"},jquery_ui:{deps:["jquery"],exports:"jquery_ui"},bootstrap:{deps:["jquery"],exports:"bootstrap"},"datepicker-backoffice":{deps:["jquery","jquery_ui"],exports:"datepicker-backoffice"},"datepicker-ru":{deps:["jquery","datepicker-backoffice"],exports:"datepicker-ru"},flexslider:{deps:["jquery"],exports:"flexslider"},multiselect:{deps:["jquery","jquery_ui"],exports:"multiselect"},bootbox:{deps:["jquery","bootstrap"],exports:"bootbox"}}});var deliveryFilterFlag=0,statusFilterFlag=0,dateFilterFlag=0,searchFilterFlag=0,orders;require(["jquery","shop-initThrift.min","commonM.min","shop-orders.min","datepicker-backoffice","datepicker-ru","bootstrap","multiselect"],function(a,b,c,d){function e(){try{orders=b.client.getOrdersByStatus(0,T+180*U,0),a(".orders-list").html("").append(h(orders));var c=a(".orders-no-init");f(c),c.removeClass("orders-no-init"),deliveryFilterFlag=0,statusFilterFlag=0,dateFilterFlag=0,searchFilterFlag=0}catch(d){}}function f(c){c.find(".plus-minus").click(function(c){c.preventDefault();var e=a(this).closest(".order-item"),f=e.find(".order-products");if(0==f.find(".catalog").length){var h=e.data("orderid"),i=b.client.getOrderDetails(h);d.showOrderDetails(e,h,i),f.append(g(i))}f.slideToggle(200,function(){a(".main-content").height()>S.height()&&a("#sidebar, .shop-right").css("height",a(".main-content").height()+45)}),a(this).hasClass("fa-plus")?a(this).removeClass("fa-plus").addClass("fa-minus"):a(this).removeClass("fa-minus").addClass("fa-plus")})}function g(a){try{var c='<section class="catalog"><table><thead><tr><td>Название</td><td>Производитель</td><td>Цена (руб)</td><td>Количество</td><td>Стоимость</td><td>Ед.изм</td><td></td></tr></thead>',d=a.odrerLines,e=d.length;V=V?V:b.client.getProducers(),W=W?W:V.length;for(var f=0;e>f;f++){for(var g,h,i="",j=0;W>j;j++)if(V[j].id==d[f].product.producerId){g=V[j].name,h=V[j].id;break}d[f].product.unitName&&(i=d[f].product.unitName);var k;k=d[f].product.imageURL?d[f].product.imageURL:"i/no-photo.png",c+='<tr class="product" data-prepack="'+d[f].product.prepackRequired+'" data-productid="'+d[f].product.id+'"><td><a href="#" class="product-link"><div class="product-pic"><img src="'+k+'" alt="картинка"/></div><span><span class="product-name">'+d[f].product.name+"</span>"+d[f].product.shortDescr+'</span></a><div class="modal"></div></td><td class="td-producer" data-producerid="'+h+'">'+g+'</td><td class="product-price">'+d[f].product.price+'</td><td class="td-spinner">'+d[f].quantity+'</td><td class="orderLine-amount"><span>'+(d[f].product.price*d[f].quantity).toFixed(1)+'</span></td><td><span class="unit-name">'+i+"</span></td></tr>"}c+="</table></section>"}catch(l){alert(l+" Функция createOrdersProductHtml")}return c}function h(a,b){try{var c="",d=a.length,e=0,f=100;b&&(f=lengthOrders,d-=offsetOrders),d>f&&(e=d-f);for(var g=d-1;g>=e;g--){var h,i=new Date(1e3*a[g].date);switch(a[g].status){case 0:h="Неизвестен";break;case 1:h="Не подтвержден";break;case 2:h="Подтвержден";break;case 3:h="Уже едет";break;case 4:h="Доставлен";break;case 5:h="Закрыт";break;case 6:h="Отменен"}var j=i.getDate();j=10>j?"0"+j:j;var k=i.getMonth()+1;k=10>k?"0"+k:k;var l="";"Подтвержден"==h&&(l="passive"),c+='<div class="order-item orders-no-init" data-orderid="'+a[g].id+'"><table class="orders-tbl"><tbody><tr><td class="td1"><a class="fa fa-plus plus-minus" href="#"></a></td><td class="td2">'+a[g].id+'</td><td class="td8 user-name">'+a[g].userName+'</td><td class="td3" id="'+a[g].date+'">'+j+"."+k+"."+i.getFullYear()+'</td><td class="td4"><div class="order-status">'+h+'</div></td><td class="td9"></td><td class="td8"></td><td class="td6">'+a[g].totalCost.toFixed(1)+'</td><td class="td1"><a href="#" title="Удалить заказ" class="delete-order '+l+'">&times;</a></td></tr></tbody></table><div class="order-bottom"><div class="order-delivery"></div></div><div class="order-products"></div></div>'}}catch(m){alert(m+" Функция createOrdersHtml")}return c}function i(a){var b;switch(a){case"Подтвержден":b=2;break;case"Не подтвержден":b=1;break;case"Отменен":b=6}return b}function j(a){var b;switch(a){case"Самовывоз":b="1";break;case"Курьер рядом":b="2";break;case"Курьер далеко":b="3"}return b}function k(c){for(var d=[],e=0,f=c.length,g=a(".type-delivery-dropdown .btn-group-text").text(),h=j(g),i=0;f>i;i++){var k=b.client.getOrderDetails(c[i].id);h==k.delivery&&(d[e++]=c[i])}return d}function l(){try{var a=X.val().split("-"),b="",c=a[2];switch(a[1]){case"01":b="Jan";break;case"02":b="Feb";break;case"03":b="March";break;case"04":b="Apr";break;case"05":b="May";break;case"06":b="June";break;case"07":b="July";break;case"08":b="Aug";break;case"09":b="Sen";break;case"10":b="Oct";break;case"11":b="Nov";break;case"12":b="Dec"}}catch(d){alert(d+" Функция getMetaDate")}return Date.parse(a[0]+" "+b+" "+c)}function m(a){var b=parseInt(l()/1e3);b-=b%86400,b+=U;for(var c=a.length,d=[],e=0,f=0;c>f;f++)a[f].date==b&&(d[e++]=a[f]);return d}function n(){var b=a(".orders-no-init");f(b),b.removeClass("orders-no-init")}function o(b){var c=0,d=[],e=b.length,f=a(".status-dropdown .btn-group-text").text(),g=i(f);for(eb=0;e>eb;eb++)g==b[eb].status&&(d[c++]=b[eb]);return d}function p(a){var c=b.client.getOrdersByStatus(0,T+180*U,0),d=q(c,a);return statusFilterFlag&&(d=o(d)),deliveryFilterFlag&&(d=k(d)),dateFilterFlag&&(d=m(d)),searchFilterFlag=1,d}function q(a,b){var c=a.length,d=[];ab=0;for(var e=0;c>e;e++)-1!=a[e].userName.toLowerCase().indexOf(b.toLowerCase())&&(d[ab++]=a[e]);return d}function r(){a(".show-full-text").click(function(b){if(b.preventDefault(),a(this).closest(".export-table").length>0)var c=b.pageX-330,d=b.pageY-90;else c=b.pageX-200,d=b.pageY-200;a(".full-text").hide(),a(this).parent().find(".full-text").css({left:c,top:d}).show()})}function s(){a(".full-text .close").click(function(b){b.preventDefault(),a(this).parent().hide()})}function t(a,b,c,d){for(var e="",f=a.length,g=c.length,h="",i=!1,j=0;g>j;j++)i||(h+='<li data-fieldtype="'+d[j]+'"><a href="#">'+c[j]+"</a></li>"),c[j]==lb&&(i=!0);for(i||(h+='<li data-fieldtype="-1"><a href="#">'+lb+"</a></li>"),j=0;f>j;j++)e+='<td><div class="btn-group import-field-dropdown"><button data-toggle="dropdown" data-fieldtype="'+b[j]+'" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">'+a[j]+'</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+h+"</ul></div></td>";return e}function u(a,b){function c(a,b){for(var c,d="",e="",f=0;b>f;f++)e=a[f],e&&e.length>30&&(c=e,e=e.slice(0,30),e+=" <a class='show-full-text' href='#'>...</a>"+'<div class="full-text"><a href="#" class="close">×</a>'+c+"</div>"),d+="<td>"+e+"</td>";return d}for(var d="",e=a.length,f=0;e>f;f++)d+="<tr>"+c(a[f],b)+"</tr>";return d}function v(b){var c,d=[],e=0,f=[];ab=0;var g=[],h=a(".ui-multiselect-menu:eq(0) .ui-multiselect-checkboxes li");switch(h.each(function(){a(this).hasClass("ui-multiselect-optgroup-label")&&(g[ab++]=a(this).index())}),b){case"orders":var i=h.slice(g[0]+1,g[1]);c=i.find('input[aria-selected="true"]');break;case"orderLine":i=h.slice(g[1]+1),c=i.find('input[aria-selected="true"]');break;case"products":var j=a(".ui-multiselect-menu:eq(1) .ui-multiselect-checkboxes li");c=j.find('input[aria-selected="true"]');break;case"packs":var k=a(".ui-multiselect-menu:eq(2) .ui-multiselect-checkboxes li");c=k.find('input[aria-selected="true"]')}return ab=0,c.each(function(){d[e++]=parseInt(a(this).val()),f[ab++]=a(this).find("+span").text()}),{fieldsMap:d,headColArray:f}}function w(b,c,d,e){var f=a(".tab-pane.active").find(".export-table");f.html("");for(var g=[],h=c-1;h>=0;h--){g=[];for(var i=b.data[h].fieldsData,j=i.rowCount,k=Math.ceil(i.elems.length/j),l=0,m=0;j>m;m++){g[m]=[];for(var n=0;k>n;n++)g[m][n]=i.elems[l++]}var o,p=0;b.data[h].fieldsMap?(o=d.headColArray,e&&(o=h==c-1?d.headColArray:e.headColArray)):(o=g[0],p=1);var q='<div class="export-single-table"><table><thead><tr>'+x(o)+"</tr></thead><tbody>"+y(g,k,p)+"</tbody></table></div>";q+='<div class="report-link"><a href="'+b.data[h].url+'">Скачать отчет</a>',f.append(q)}}function x(a){var b="",c=a.length;for(eb=0;c>eb;eb++)b+="<td>"+a[eb]+"</td>";return b}function y(a,b,c){function d(a,b){for(var c,d="",e="",f=0;b>f;f++)e=a[f],e&&e.length>30&&(c=e,e=e.slice(0,30),e+=" <a class='show-full-text' href='#'>...</a>"+'<div class="full-text"><a href="#" class="close">×</a>'+c+"</div>"),d+="<td>"+e+"</td>";return d}for(var e="",f=a.length,g=c;f>g;g++)e+="<tr>"+d(a[g],b)+"</tr>";return e}function z(b){try{var c=a(".main-content"),d=b?b:c.height();d>S.height()?(d=b?b+100:c.height()+45,a("#sidebar").css("height",d)):a("#sidebar").css("height","100%")}catch(e){alert(e+" Функция setSidebarHeight")}}function A(b){var c=document.createElement("div");c.appendChild(document.createElement("div")),c.style.overflow="auto",c.style.overflowY="hidden",c.firstChild.style.width=b.scrollWidth+"px",c.firstChild.style.paddingTop="1px",c.firstChild.style.marginTop="-5px",c.firstChild.appendChild(document.createTextNode(" ")),c.onscroll=function(){b.scrollLeft=c.scrollLeft},b.onscroll=function(){c.scrollLeft=b.scrollLeft},b.parentNode.insertBefore(c,b),a(b).prev().addClass("top-scroll")}function B(){a("#settings-logo").ace_file_input({style:"well",btn_choose:"Изменить логотип",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large",icon_remove:null}).on("change",function(){a(".logo-container>img").hide()}).parent().addClass("settings-logo"),a("#date-picker-6").datepicker({autoclose:!0,language:"ru"});var c=a(".backoffice.dynamic").attr("id"),d=b.client.getShop(c),e=d.deliveryCostByDistance,f="";for(var g in e)f+='<div class="delivery-interval delivery-price-type"><input type="text" value="'+g+'"><span>км</span><input type="text" value="'+e[g]+'"><span>руб</span><a href="#" class="add-delivery-interval add-interval">+</a></div>';""==f&&(f+='<div class="delivery-interval delivery-price-type"><input type="text" placeholder="Интервал"><span>км</span><input type="text" placeholder="Стоимость"><span>руб</span><a href="#" class="add-delivery-interval add-interval">+</a></div>'),a(".delivery-interval-container").append(f);var h=d.deliveryByWeightIncrement,i="";for(var g in h)i+='<div class="delivery-weight delivery-price-type"><input type="text" value="'+g+'"><span>кг</span><input type="text" value="'+h[g]+'"><span>руб</span><a href="#" class="add-delivery-interval add-interval">+</a></div>';""==i&&(i+='<div class="delivery-weight delivery-price-type"><input type="text" placeholder="Интервал"><span>кг</span><input type="text" placeholder="Стоимость"><span>руб</span><a href="#" class="add-delivery-interval add-interval">+</a></div>'),a(".delivery-weight-container").append(i);var j=d.deliveryTypeAddressMasks,k="";for(var g in j)k+='<div class="delivery-area  delivery-price-type"><span>'+g+'</span><input type="text" value="'+j[g]+'"><span>руб</span></div>';""==k&&(k+='<div class="delivery-area  delivery-price-type"><span>Близко</span><input type="text" placeholder="Стоимость"><span>руб</span></div><div class="delivery-area  delivery-price-type"><span>Далеко</span><input type="text" placeholder="Стоимость"><span>руб</span></div>'),a(".delivery-area-container").append(k),a(".add-interval").click(function(b){b.preventDefault();var c,d=a(this).closest(".delivery-price-type").hasClass("delivery-interval");c=d?'<div class="delivery-interval new-interval delivery-price-type"><input type="text" placeholder="Интервал"><span>км</span>&nbsp;<input type="text" placeholder="Стоимость"><span>руб</span>&nbsp;<a href="#" class="add-delivery-interval remove-interval">&ndash;</a></div>':'<div class="delivery-weight new-interval delivery-price-type"><input type="text" placeholder="Интервал"><span>кг</span>&nbsp;<input type="text" placeholder="Стоимость"><span>руб</span>&nbsp;<a href="#" class="add-delivery-interval remove-interval">&ndash;</a></div>',a(this).closest(".delivery-price-type").after(c),a(".new-interval .remove-interval").click(function(b){b.preventDefault(),a(this).closest(".new-interval").slideUp(200,function(){a(this).detach()})}),a(".new-interval").slideDown().removeClass(".new-interval")})}function C(a,b){try{var c=a.find(".datepicker-days .switch").text().split(" "),d="",e=c[1];switch(c[0]){case"Январь":d="Jan";break;case"Февраль":d="Feb";break;case"Март":d="March";break;case"Апрель":d="Apr";break;case"Май":d="May";break;case"Июнь":d="June";break;case"Июль":d="July";break;case"Август":d="Aug";break;case"Сентябрь":d="Sen";break;case"Октябрь":d="Oct";break;case"Ноябрь":d="Nov";break;case"Декабрь":d="Dec"}}catch(f){alert(f+" Функция getMetaDate")}return Date.parse(b+" "+d+" "+e)}function D(b,c){var d=new com.vmesteonline.be.shop.FullProductInfo;d.product=new com.vmesteonline.be.shop.Product,d.details=new com.vmesteonline.be.shop.ProductDetails,d.product.id=c?0:b.attr("id"),console.log("productInfo.product.id "+b.attr("id")),d.product.name=b.find(".product-name textarea").val(),d.product.shortDescr=b.find(".product-shortDescr textarea").val(),d.product.producerId=b.find(".product-producer").data("producerid");var e=b.find(".product-imageURL .file-name img");d.product.imageURL=e.length?e.css("background-image"):b.find(".product-imageURL>img").attr("src"),d.product.weight=b.find(".product-weight input").val()?parseFloat(b.find(".product-weight input").val()):0,d.product.price=b.find(".product-price input").val()?parseFloat(b.find(".product-price input").val()):0,d.product.unitName=b.find(".product-unitName input").val(),d.product.minClientPack=b.find(".product-pack input").val()?parseFloat(b.find(".product-pack input").val()):0,d.product.prepackRequired=b.find(".product-prepack input").attr("checked")?!0:!1,console.log("productInfo.product.id "+d.product.id),d.details.fullDescr=b.find(".product-fullDescr textarea").val();var f=0,g=b.find(".product-imagesSet").find(".file-name img").length;if(g){var h=[];b.find(".product-imagesSet .ace-file-input.added").each(function(){h[f++]=a(this).find(".file-name img").css("background-image")}),d.details.imagesURLset=h}console.log("2"),f=0;var i=[];b.find(".product-categories .category-item").each(function(){i[f++]=a(this).data("categoryid")}),d.details.categories=i,console.log("3");var j=[];return b.find(".product-options table tr").each(function(){j[a(this).find("td:eq(0)").text()]=a(this).find("td:eq(1)").text()}),d.details.options=j,console.log("4"),d}function E(){var c,d=a(".products-table>table");d.find("tbody tr").each(function(){var d=a(this).attr("id");c=b.client.getProductDetails(d);var e=c.imagesURLset,f=e.length,g="<div class='images-set'>";if(0!=f)for(var h=0;f>h;h++)g+="<div class='image-item map-item'><a href='#' class='remove-image-item remove-item'>&times</a><img src='"+e[h]+"'></div>";g+="</div><input type='file' id='imagesURLSet-"+d+"-"+f+"'>";for(var i=c.categories,j=i.length,k="",h=0;j>h;h++)k+="<div class='category-item map-item' data-categoryid='"+i[h]+"'><a href='#' class='remove-category-item remove-item'>&times</a>"+F(i[h]).name+"</div>";k+=F();var l=c.optionsMap,m="<table>";for(var n in l)m+="<tr><td><input type='text' value='"+n+"'></td><td><input type='text' value='"+l[n]+"'></td><td class='td-remove-options'><a href='' class='remove-options-item remove-item'>&times;</a></td></tr>";m+="</table><a href='#' class='add-options-item add-item'>Добавить</a>";for(var o,p=a(this).find(".product-producer").data("producerid"),q=b.client.getProducers(),r=q.length,s="",h=0;r>h;h++)q[h].id==p&&(o=q[h]),s+="<li data-producerid='"+q[h].id+"'><a href='#'>"+q[h].name+"</a></li>";var t="<span>"+o.name+'</span><div class="btn-group producers-dropdown"><button data-toggle="dropdown" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">Изменить</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+s+"</ul></div>",u=a(this);a("#imageURL-"+d).ace_file_input({style:"well",btn_choose:"",btn_change:null,no_icon:"",droppable:!0,icon_remove:null,thumbnail:"large"}).on("change",function(){u.find(".product-imageURL .file-label").css("opacity",1),u.find(".product-imageURL>img").hide()}),a(this).find(".product-fullDescr textarea").val(c.fullDescr),a(this).find(".product-imagesSet").html(g),a("#imagesURLSet-"+d+"-"+f).ace_file_input({style:"well",btn_choose:"Добавить",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var b=a(this);G(d,f,b)}),H(a(this).find(".ace-file-input")),a(this).find(".product-categories").html(k),I(a(this)),J(a(this)),a(this).find(".product-options").html(m),K(a(this)),L(a(this)),a(this).find(".product-producer").html(t),M(a(this))})}function F(c){var d=a(".backoffice.dynamic").attr("id"),e=b.client.getAllCategories(d),f=e.length,g="";if(c){for(var h,i=0;f>i;i++)e[i].id==c&&(h=e[i]);return h}for(var i=0;f>i;i++)g+='<li data-categoryid="'+e[i].id+'"><a href="#">'+e[i].name+"</a></li>";var j='<div class="btn-group categories-dropdown"><button data-toggle="dropdown" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">Добавить</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+g+"</ul></div>";return j}function G(b,c,d){if(!d.parent().hasClass("added")){d.parent().addClass("added"),c++;var e="<input type='file' class='new-input' id='imagesURLSet-"+b+"-"+c+"'>";d.parent().after(e),a("#imagesURLSet-"+b+"-"+c).ace_file_input({style:"well",btn_choose:"Добавить",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var d=a(this);G(b,c,d)}),H(d.parent())}}function H(b){b.find(".remove").click(function(b){b.preventDefault(),a(this).closest(".ace-file-input").hide().detach()})}function I(b){b.find(".remove-category-item").click(function(b){b.preventDefault(),a(this).closest(".map-item").fadeOut(200)})}function J(b){b.find(".categories-dropdown .dropdown-menu a").click(function(b){b.preventDefault();var c='<div class="category-item map-item" data-categoryid="'+a(this).closest("li").data("categoryid")+'"><a href="#" class="remove-category-item remove-item">×</a>'+a(this).text()+"</div>";a(this).closest("td").find(".categories-dropdown").before(c),I(a(this).closest("td"))})}function K(b){b.find(".remove-options-item").click(function(b){b.preventDefault(),a(this).closest("tr").slideUp(200,function(){a(this).detach()})})}function L(b){b.find(".add-options-item ").click(function(b){b.preventDefault();var c='<tr><td><input type="text" value=""></td><td><input type="text" value=""></td><td class="td-remove-options"><a href="" class="remove-options-item remove-item">×</a></td></tr>';a(this).closest("td").find("table tbody").append(c),K(a(this).closest("td"))})}function M(b){b.find(".producers-dropdown .dropdown-menu a").click(function(b){b.preventDefault();var c=a(this).text(),d=a(this).closest("li").data("producerid");a(this).closest("td").attr("id",d).find(">span").text(c)})}function N(a){var b=a.text(),c=a.closest("li").data("categoryid");a.closest(".category-parent").attr("data-parentid",c).find(".btn-group-text").text(b)}function O(a,b){var c=new com.vmesteonline.be.shop.ProductCategory;return c.id=b?0:a.attr("id"),c.name=a.find(".category-name textarea").val(),c.descr=a.find(".category-descr textarea").val(),c.parentId=a.find(".category-parent").data("parentid"),c}function P(a,b){var c=new com.vmesteonline.be.shop.Producer;return c.id=b?0:a.attr("id"),c.name=a.find(".category-name textarea").val(),c.descr=a.find(".category-descr textarea").val(),c}function Q(a,c){var d,e=b.userClient.getUserContactsExt(a);d=c?"; ":"<br>";var f="Email: "+e.email;return e.mobilePhone?f+=d+" Телефон: "+e.mobilePhone:!1,e.homeAddress?f+=d+" Адрес: "+e.homeAddress.street.name+" "+e.homeAddress.building.fullNo+", "+e.homeAddress.flatNo:!1,f}function R(a,b){a.find("span").text(b.firstName+" "+b.lastName),a.closest("tr").find(".owner-contacts").html(Q(b.id))}if(a(".container.backoffice").hasClass("noAccess"))bootbox.alert("У вас нет прав доступа !",function(){document.location.replace("./shop.jsp")});else{c.init();var S=a(window),T=parseInt((new Date).getTime()/1e3);T-=T%86400;var U=86400;e();var V,W;a(".delete-order").click(function(c){if(c.preventDefault(),!a(this).hasClass("passive")){var d=a(this).closest(".order-item"),e=d.data("orderid");b.client.deleteOrder(e),d.slideUp()}});try{var X=a("#date-picker-1"),Y=a(".datepicker-export");globalUserAuth=!0,X.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()}),console.log("---------------------"),Y.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()});var Z={createOrdersHtml:h,initOrderPlusMinus:f,setSidebarHeight:z,filterByStatus:o,filterByDelivery:k,filterBySearch:q};X.datepicker("setVarOrderDates",Z),Y.datepicker("setVarOrderDates",Z),a(".reset-filters").click(function(){e(),a(".type-delivery-dropdown .btn-group-text").text("Тип доставки"),a(".status-dropdown .btn-group-text").text("Статус заказа"),a("#back-search").val("Поиск по имени клиента или номеру телефона"),X.val("Фильтр по дате")})}catch($){}a("#date-picker-2,#date-picker-3,#date-picker-4").val("Фильтр по дате"),a(".export .checkbox input.ace").prop("checked",!1),a(".status-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=a(this).find("a").text(),e=i(d),f=b.client.getOrdersByStatus(0,T+180*U,e);deliveryFilterFlag&&(f=k(f)),searchFilterFlag&&(f=q(f,a("#back-search").val())),dateFilterFlag&&(f=m(f)),a(".orders-list").html("").append(h(f)),n(),statusFilterFlag=1}),a(".type-delivery-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=b.client.getOrdersByStatus(0,T+180*U,0),e=k(d);statusFilterFlag&&(e=o(e)),searchFilterFlag&&(e=q(e,a("#back-search").val())),dateFilterFlag&&(e=m(e)),a(".orders-list").html("").append(h(e)),n(),deliveryFilterFlag=1});var _=[],ab=0;a(".back-orders .order-item").each(function(){_[ab++]=a(this).find(".user-name").text()});var bb=_.length,cb=[],db=0;ab=0;for(var eb=0;bb-1>eb;eb++){db=0;for(var fb=eb+1;bb>fb;fb++)_[eb]==_[fb]&&(db=1);db||(cb[ab++]=_[eb])}cb[ab]=_[bb-1],a("#back-search").focus(function(){a(this).autocomplete({source:cb,select:function(b,c){a(".orders-list").html("").append(h(p(c.item.label))),n()}})}),a(".search-form").submit(function(b){b.preventDefault();var c=a("#back-search").val();a(".orders-list").html("").append(h(p(c))),n()});var gb,hb,ib,jb,kb=[];a(".form-import").submit(function(c){c.preventDefault();var d=a("#import-data").val();if("Тип импортируемых данных"==a(".import-dropdown .btn-group-text").text())a(".import").find(".error-info").text("Пожалуйста, укажите тип импортируемых данных.").show();else if(d){{a("#import-public").val()}d=d.split("\\");var e=d.length,f=(d[e-1],new FormData),g=a(".form-import #import-data");f.append("data",g[0].files[0]),a.ajax({type:"POST",url:"/file/",cache:!1,processData:!1,contentType:!1,data:f,success:function(c){jb=c;var d=b.clientBO.parseCSVfile(jb);gb=d.elems,hb=d.rowCount;var e=gb.length;ib=e/hb;var f=0;kb=[];for(var g=0;hb>g;g++){kb[g]=[];for(var h=0;ib>h;h++)kb[g][h]=gb[f++]}var i=a(".import-dropdown .btn-group-text").text(),j=[],k=[],l=com.vmesteonline.be.shop.bo.ExchangeFieldType;switch(f=0,i){case"Продукты":for(var m in l)l[m]>=300&&l[m]<330&&(j[f]=m,k[f++]=l[m]);break;case"Категории продуктов":for(m in l)l[m]>=200&&l[m]<230&&(j[f]=m,k[f++]=l[m]);break;case"Производители":for(m in l)l[m]>=100&&l[m]<130&&(j[f]=m,k[f++]=l[m])}var n,o,p=j.slice(0),q=k.slice(0);if(f>ib)for(n=f,o=ib,g=n-1;g>=o;g--)j.pop(),k.pop();if(ib>f)for(n=ib,o=f,g=n-1;g>=o;g--)j[g]=lb,k[g]=-1;var v="<table><thead><tr>"+t(j,k,p,q)+"</tr></thead><tbody>"+u(kb,j.length)+"</tbody></table>";a(".import-table").html("").prepend(v).parent().show(),a(".top-scroll").remove(),A(document.getElementById("doublescroll")),r(),s(),a(".import-field-dropdown .dropdown-toggle").click(function(b){b.preventDefault();var c=a(this).closest("td").index(),d=0,e=0;a(".import-table table").find("td").each(function(){c>e&&(d+=a(this).width()),e++}),d-=a(".import-table").scrollLeft();var f=94;a(this).parent().find(".dropdown-menu").css({left:d,top:f})}),a(".import-field-dropdown .dropdown-menu").find("li a").click(function(b){b.preventDefault();var c=a(this).parent().text(),d=a(this).parent().data("fieldtype");a(".import-field-dropdown").each(function(){a(this).find(".btn-group-text").text()==c&&(a(this).find(".dropdown-toggle").attr("data-fieldtype",-1),a(this).find(".btn-group-text").text(lb))});var e=a(this).closest(".import-field-dropdown");e.find(".btn-group-text").text(c).parent().data("fieldtype",d)})}})}else a(".import").find(".error-info").text("Пожалуйста, выберите файл.").show()}),a("#import-data").click(function(){a(".import").find(".error-info").hide()}),a(".checkbox .lbl").click(function(){a(this).closest(".checkbox").toggleClass("active")}),a(".import-dropdown .dropdown-menu li").click(function(){a(".import").find(".error-info").hide()});var lb="SKIP";a(".import-btn").click(function(c){function d(){a(".confirm-info").hide()}c.preventDefault();var e=a(".import-field-dropdown"),f=e.length,g="",h=!1;e.each(function(){if(!h)for(var b=a(this).parent().index(),c=a(this).find(".btn-group-text").text(),d=b+1;f>d;d++)if(c==e.eq(d).find(".btn-group-text").text()&&c!=lb){g=c,h=!0;break}});var i=a(this).closest(".back-tab").find(".confirm-info");if(h)i.text("Вы указали два столбца с одинаковым занчением : "+g).show();else{i.hide();var j,k=a(".import-dropdown .btn-group-text").text();switch(k){case"Продукты":j=com.vmesteonline.be.shop.bo.ImExType.IMPORT_PRODUCTS;break;case"Категории продуктов":j=com.vmesteonline.be.shop.bo.ImExType.IMPORT_CATEGORIES;break;case"Производители":j=com.vmesteonline.be.shop.bo.ImExType.IMPORT_PRODUCERS}var l=[],m=0;a(".import .import-field-dropdown").each(function(){var b=a(this).find(".btn-group-text").text();b!=lb&&(l[m]=parseInt(a(this).find(".btn").data("fieldtype"))),m++});var n=new com.vmesteonline.be.shop.bo.ImportElement;n.type=j,n.filename="filename",n.fieldsMap=l,n.url=jb;var o=[];o[0]=n;var p=new com.vmesteonline.be.shop.bo.DataSet;p.name="name",p.date=T,p.data=o,a(".loading").fadeIn(function(){try{b.clientBO.importData(p),i.text("Данные успешно импортированы.").addClass("info-good").show()}catch(c){i.text("Ошибка импорта.").show()}a(".loading").fadeOut(0),setTimeout(d,3e3)})}}),a(".export-orders-checklist select, .export-products-checklist select, .export-packs-checklist select").multiselect({noneSelectedText:"Опции",selectedText:"Опции (# выбрано)",checkAllText:"Выбрать все",uncheckAllText:"Отменить все"}),a(".ui-multiselect").addClass("btn btn-sm btn-info no-border"),a(".ui-multiselect .ui-icon").addClass("icon-caret-down"),a(".export .nav-tabs").find("li").click(function(){var b=a(this).index(),c=a(".export .tab-pane:eq("+b+")").addClass("active").height();z(c)}),a(".export-btn").click(function(c){c.preventDefault();var d=a(this).closest(".tab-pane"),e=d.find(".export-delivery-dropdown .btn-group-text").text(),f=d.find(".datepicker-export").attr("data-selectorderdate");if(f){d.find(".error-info").hide(),d.find(".confirm-info").hide();var g=a(".export .nav-tabs").find("li"),h=0;g.each(function(){a(this).hasClass("active")&&(h=a(this).index())});var i;i="Тип доставки"!=e&&"Все"!=e?j(e):0;var k;try{switch(h){case 0:var l=v("orders"),m=v("orderLine");k=b.clientBO.getTotalOrdersReport(f,i,l.fieldsMap,m.fieldsMap);var n;k.data&&(n=k.data.length,w(k,n,l,m));break;case 1:var o=v("products");k=b.clientBO.getTotalProductsReport(f,i,o.fieldsMap),k.data&&(n=k.data.length,w(k,n,o));break;case 2:o=v("packs"),k=b.clientBO.getTotalPackReport(f,i,o.fieldsMap),k.data&&(n=k.data.length,w(k,n,o))}r(),s(),k.data||d.find(".confirm-info").text("Нет данных на такое сочетание даты и типа доставки.").show(),z()}catch(c){d.find(".confirm-info").text("Ошибка экспорта.").show()}}else d.find(".error-info").text("Пожалуйста, укажите дату с заказом.").show()}),a(".container.backoffice .nav-list a").click(function(b){b.preventDefault(),a(".back-tab").hide();var c=a(this).parent().index();switch(c){case 0:a(".back-orders").show();break;case 1:a(".bo-edit").show(),E(),A(document.getElementById("doublescroll-2"));break;case 2:a(".export").show();break;case 3:a(".import").show();break;case 4:a(".bo-settings").show(),B()}a(this).closest("ul").find(".active").removeClass("active"),a(this).parent().addClass("active"),z()}),a(".settings-item .btn-save").click(function(c){c.preventDefault();var d=a(this).closest(".settings-item").attr("id");switch(d){case"settings-common":var e=a("#settings-common"),f=myShop;f.name=e.find(a("#name")).val(),f.descr=e.find(a("#descr")).val(),f.address=b.client.createDeliveryAddress(e.find(a("#address")).val());var g=a(".logo-container .file-name img");f.logoURL=g.length?g.css("background-image"):a(".logo-container>img").attr("src"),b.clientBO.updateShop(f);break;case"settings-shedule":var h=new com.vmesteonline.be.shop.OrderDates;h.type=com.vmesteonline.be.shop.OrderDatesType.ORDER_WEEKLY;var i=86400;h.orderBefore=parseInt(a("#days-before").val())*i,a(".shedule-dates .selected").each(function(){h.orderDay=a(this).data("date"),b.clientBO.setDate(h)});break;case"settings-delivery":f=myShop;var j=[];a(".delivery-interval").each(function(){var b=parseInt(a(this).find("input:eq(0)").val()),c=parseFloat(a(this).find("input:eq(1)").val());b&&c&&(j[b]=c),console.log("key "+b+"; value "+c)}),f.deliveryCostByDistance=j;var k=[],l=0;a(".delivery-area").each(function(){var b;b=l?com.vmesteonline.be.shop.DeliveryType.SHORT_RANGE:com.vmesteonline.be.shop.DeliveryType.LONG_RANGE,l++;var c=a(this).find("input:eq(0)").val();c&&(k[b]=c)}),f.deliveryTypeAddressMasks=k;var m=[];a(".delivery-weight").each(function(){var b=parseInt(a(this).find("input:eq(0)").val()),c=parseInt(a(this).find("input:eq(1)").val());b&&c&&(m[b]=c)}),f.deliveryByWeightIncrement=m,b.clientBO.updateShop(f)}}),a(".shedule-dates td").click(function(c){if(c.preventDefault(),!a(this).hasClass("new")&&!a(this).hasClass("old")){c.stopPropagation(),a(this).addClass("selected");var d=a(this).text(),e=parseInt(C(a(this).closest(".shedule-dates"),d)/1e3);e-=e%86400,a(this).attr("data-date",e),0==a(this).find(".remove-date").length&&a(this).append("<a class='remove-date' href='#'>&times;</a>"),a(this).find(".remove-date").click(function(c){c.preventDefault(),c.stopPropagation();var d=new com.vmesteonline.be.shop.OrderDates;d.type=com.vmesteonline.be.shop.OrderDatesType.ORDER_WEEKLY;var e=86400;d.orderBefore=parseInt(a("#days-before").val())*e,d.orderDay=a(this).parent().data("date"),b.clientBO.removeDate(d),a(this).parent().removeClass("selected"),a(this).hide().detach()})}}),a(".edit-show-add").click(function(b){b.preventDefault(),a(this).find("+.table-add").slideToggle();var c=a(this).closest(".tab-pane").attr("id");switch(c){case"edit-product":var d=a(".table-add-product table tr");a("#imageURL-add").ace_file_input({style:"well",btn_choose:"",btn_change:null,no_icon:"",droppable:!0,icon_remove:null,thumbnail:"large"}).on("change",function(){d.find(".product-imageURL .file-label").css("opacity",1),d.find(".product-imageURL>img").hide()}),a("#imageURLSet-add").ace_file_input({style:"well",btn_choose:"Добавить изображение",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var b=a(this);G(0,0,b)}),H(a(".table-add-product table .product-imagesSet"));
var e=F(),f=a(".table-add-product .product-categories");f.html(e),I(f),J(f);var g=a(".table-add-product .product-options");K(g),L(g),a(this).find("+.table-add .product-producer .dropdown-menu a").click(function(){var b=a(this).parent().data("producerid");a(this).closest("td").attr("data-producerid",b)});break;case"edit-category":break;case"edit-producer":}}),a(".table-add-product .edit-add").click(function(c){c.preventDefault();var d=a(".backoffice.dynamic").attr("id"),e=a(this).closest(".table-add-product").find("table tr"),f=!0,g=D(e,f);g.product.producerId?(a(".error-info").hide(),b.clientBO.registerProduct(g,d),console.log("5"),a(this).closest(".table-add-product").slideUp(function(){var b=e.clone();b.addClass("hidden"),a(".product-table table tbody").prepend(b),b.slideDown()})):a(".error-info").text("Вы не указали производителя !").show()}),a(".product-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteProduct(d,e)}),a(".save-products").click(function(c){c.preventDefault(),a("#edit-product table .changed").each(function(){var c=a(this),d=!1,e=D(c,d);b.clientBO.updateProduct(e)})}),a("#edit-product .products-table table tr,#edit-category .category-table tr, #edit-producer .producer-table tr").click(function(){a(this).addClass("changed")}),a(".category-parent").each(function(){var b=F();if(a(this).html(b),a(this).find(".btn-group-text").text("Выбрать родительскую"),a(this).find(".dropdown-menu a").click(function(b){b.preventDefault(),N(a(this))}),0==a(this).closest(".table-add").length){var c=a(this).data("parentid");a(this).find(".dropdown-menu li").each(function(){a(this).data("categoryid")==c&&N(a(this))})}}),a(".table-add-category .edit-add").click(function(c){c.preventDefault();var d=a(".backoffice.dynamic").attr("id"),e=a(this).closest(".table-add-category").find("table tr"),f=!0,g=O(e,f);a(".error-info").hide(),b.clientBO.registerProductCategory(g,d),a(this).closest(".table-add-category").slideUp(function(){var b=e.clone();b.addClass("hidden"),a(".product-table table tbody").prepend(b),b.slideDown()})}),a(".save-categories").click(function(c){c.preventDefault(),a(".category-table tr.changed").each(function(){var c=a(this),d=!1,e=O(c,d);b.clientBO.updateCategory(e)})}),a(".category-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteCategory(d,e)}),a(".table-add-producer .edit-add").click(function(c){c.preventDefault();var d=a(".backoffice.dynamic").attr("id"),e=a(this).closest(".table-add-producer").find("table tr"),f=!0,g=P(e,f);a(".error-info").hide(),b.clientBO.registerProducer(g,d),a(this).closest(".table-add-producer").slideUp(function(){var b=e.clone();b.addClass("hidden"),a(".product-table table tbody").prepend(b),b.slideDown()})}),a(".save-producers").click(function(c){c.preventDefault(),a(".producer-table tr.changed").each(function(){var c=a(this),d=!1,e=P(c,d);b.clientBO.updateProducer(e)})}),a(".producer-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteProducer(d,e)})}a(".adminka-shops table tr").each(function(){var c=a(this).attr("id"),d=b.client.getShop(c),e=b.userClient.getUserInfoExt(d.ownerId),f=Q(d.ownerId);a(".owner-name span").text(e.firstName+" "+e.lastName),a(".owner-contacts").html(f)}),a(".update-owner-link").click(function(c){c.preventDefault();var d="<div class='update-owner-line'><input type='text' class='owner-email' placeholder='email нового владельца'><a href='#' class='btn btn-sm no-border btn-primary btn-update'>Изменить</a></div>",e=a(this).closest("td");0==e.find(".update-owner-line").length&&e.append(d),e.find(".update-owner-line").slideToggle(),e.find(".btn-update").one("click",function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),f=a(this).closest("td").find(".owner-email").val(),g=b.clientBO.setUserShopRole(d,f,3);e.find(".update-owner-line").slideToggle(),R(e,g)})}),a(".adminka .nav-list a").click(function(b){b.preventDefault(),a(".back-tab").hide();var c=a(this).parent().index();switch(c){case 0:a(".adminka-shops").show();break;case 1:a(".adminka-users").show()}a(this).closest("ul").find(".active").removeClass("active"),a(this).parent().addClass("active")})});