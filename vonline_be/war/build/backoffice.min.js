require.config({baseUrl:"/build",paths:{jquery:"../js/lib/jquery-2.1.1.min",bootstrap:"../js/lib/bootstrap.min",ace_extra:"../js/lib/ace-extra.min",ace_elements:"../js/lib/ace-elements.min",jquery_ui:"../js/lib/jquery-ui-1.10.3.full.min",flexslider:"../js/lib/jquery.flexslider-min",ace_spinner:"../js/lib/fuelux/fuelux.spinner","datepicker-backoffice":"../js/bootstrap-datepicker-backoffice","datepicker-ru":"../js/lib/date-time/locales/bootstrap-datepicker.ru",multiselect:"../js/lib/jquery.multiselect.min",bootbox:"../js/bootbox.min"},shim:{ace_spinner:{deps:["jquery","ace_extra","ace_elements","jquery_ui"],exports:"ace_spinner"},jquery_ui:{deps:["jquery"],exports:"jquery_ui"},bootstrap:{deps:["jquery"],exports:"bootstrap"},"datepicker-backoffice":{deps:["jquery","jquery_ui"],exports:"datepicker-backoffice"},"datepicker-ru":{deps:["jquery","datepicker-backoffice"],exports:"datepicker-ru"},flexslider:{deps:["jquery"],exports:"flexslider"},multiselect:{deps:["jquery","jquery_ui"],exports:"multiselect"},bootbox:{deps:["jquery","bootstrap"],exports:"bootbox"}}});var deliveryFilterFlag=0,statusFilterFlag=0,dateFilterFlag=0,searchFilterFlag=0,orders;require(["jquery","shop-initThrift.min","commonM.min","shop-orders.min","datepicker-backoffice","datepicker-ru","bootstrap","multiselect"],function(a,b,c,d){function e(){try{orders=b.client.getOrdersByStatus(0,L+180*M,0),a(".orders-list").html("").append(h(orders));var c=a(".orders-no-init");f(c),c.removeClass("orders-no-init"),deliveryFilterFlag=0,statusFilterFlag=0,dateFilterFlag=0,searchFilterFlag=0}catch(d){}}function f(c){c.find(".plus-minus").click(function(c){c.preventDefault();var e=a(this).closest(".order-item"),f=e.find(".order-products");if(0==f.find(".catalog").length){var h=e.data("orderid"),i=b.client.getOrderDetails(h);d.showOrderDetails(e,h,i),f.append(g(i))}f.slideToggle(200,function(){a(".main-content").height()>K.height()&&a("#sidebar, .shop-right").css("height",a(".main-content").height()+45)}),a(this).hasClass("fa-plus")?a(this).removeClass("fa-plus").addClass("fa-minus"):a(this).removeClass("fa-minus").addClass("fa-plus")})}function g(a){try{var c='<section class="catalog"><table><thead><tr><td>Название</td><td>Производитель</td><td>Цена (руб)</td><td>Количество</td><td>Стоимость</td><td>Ед.изм</td><td></td></tr></thead>',d=a.odrerLines,e=d.length;N=N?N:b.client.getProducers(),O=O?O:N.length;for(var f=0;e>f;f++){for(var g,h,i="",j=0;O>j;j++)if(N[j].id==d[f].product.producerId){g=N[j].name,h=N[j].id;break}d[f].product.unitName&&(i=d[f].product.unitName);var k;k=d[f].product.imageURL?d[f].product.imageURL:"i/no-photo.png",c+='<tr class="product" data-prepack="'+d[f].product.prepackRequired+'" data-productid="'+d[f].product.id+'"><td><a href="#" class="product-link"><div class="product-pic"><img src="'+k+'" alt="картинка"/></div><span><span class="product-name">'+d[f].product.name+"</span>"+d[f].product.shortDescr+'</span></a><div class="modal"></div></td><td class="td-producer" data-producerid="'+h+'">'+g+'</td><td class="product-price">'+d[f].product.price+'</td><td class="td-spinner">'+d[f].quantity+'</td><td class="orderLine-amount"><span>'+(d[f].product.price*d[f].quantity).toFixed(1)+'</span></td><td><span class="unit-name">'+i+"</span></td></tr>"}c+="</table></section>"}catch(l){alert(l+" Функция createOrdersProductHtml")}return c}function h(a,b){try{var c="",d=a.length,e=0,f=100;b&&(f=lengthOrders,d-=offsetOrders),d>f&&(e=d-f);for(var g=d-1;g>=e;g--){var h,i=new Date(1e3*a[g].date);switch(a[g].status){case 0:h="Неизвестен";break;case 1:h="Не подтвержден";break;case 2:h="Подтвержден";break;case 3:h="Уже едет";break;case 4:h="Доставлен";break;case 5:h="Закрыт";break;case 6:h="Отменен"}var j=i.getDate();j=10>j?"0"+j:j;var k=i.getMonth()+1;k=10>k?"0"+k:k;var l="";"Подтвержден"==h&&(l="passive"),c+='<div class="order-item orders-no-init" data-orderid="'+a[g].id+'"><table class="orders-tbl"><tbody><tr><td class="td1"><a class="fa fa-plus plus-minus" href="#"></a></td><td class="td2">'+a[g].id+'</td><td class="td8 user-name">'+a[g].userName+'</td><td class="td3" id="'+a[g].date+'">'+j+"."+k+"."+i.getFullYear()+'</td><td class="td4"><div class="order-status">'+h+'</div></td><td class="td9"></td><td class="td8"></td><td class="td6">'+a[g].totalCost.toFixed(1)+'</td><td class="td1"><a href="#" title="Удалить заказ" class="delete-order '+l+'">&times;</a></td></tr></tbody></table><div class="order-bottom"><div class="order-delivery"></div></div><div class="order-products"></div></div>'}}catch(m){alert(m+" Функция createOrdersHtml")}return c}function i(a){var b;switch(a){case"Подтвержден":b=2;break;case"Не подтвержден":b=1;break;case"Отменен":b=6}return b}function j(a){var b;switch(a){case"Самовывоз":b="1";break;case"Курьер рядом":b="2";break;case"Курьер далеко":b="3"}return b}function k(c){for(var d=[],e=0,f=c.length,g=a(".type-delivery-dropdown .btn-group-text").text(),h=j(g),i=0;f>i;i++){var k=b.client.getOrderDetails(c[i].id);h==k.delivery&&(d[e++]=c[i])}return d}function l(){try{var a=P.val().split("-"),b="",c=a[2];switch(a[1]){case"01":b="Jan";break;case"02":b="Feb";break;case"03":b="March";break;case"04":b="Apr";break;case"05":b="May";break;case"06":b="June";break;case"07":b="July";break;case"08":b="Aug";break;case"09":b="Sen";break;case"10":b="Oct";break;case"11":b="Nov";break;case"12":b="Dec"}}catch(d){alert(d+" Функция getMetaDate")}return Date.parse(a[0]+" "+b+" "+c)}function m(a){var b=parseInt(l()/1e3);b-=b%86400,b+=M;for(var c=a.length,d=[],e=0,f=0;c>f;f++)a[f].date==b&&(d[e++]=a[f]);return d}function n(){var b=a(".orders-no-init");f(b),b.removeClass("orders-no-init")}function o(b){var c=0,d=[],e=b.length,f=a(".status-dropdown .btn-group-text").text(),g=i(f);for(Y=0;e>Y;Y++)g==b[Y].status&&(d[c++]=b[Y]);return d}function p(a){var c=b.client.getOrdersByStatus(0,L+180*M,0),d=q(c,a);return statusFilterFlag&&(d=o(d)),deliveryFilterFlag&&(d=k(d)),dateFilterFlag&&(d=m(d)),searchFilterFlag=1,d}function q(a,b){var c=a.length,d=[];U=0;for(var e=0;c>e;e++)-1!=a[e].userName.toLowerCase().indexOf(b.toLowerCase())&&(d[U++]=a[e]);return d}function r(){a(".show-full-text").click(function(b){if(b.preventDefault(),a(this).closest(".export-table").length>0)var c=b.pageX-330,d=b.pageY-90;else c=b.pageX-200,d=b.pageY-200;a(".full-text").hide(),a(this).parent().find(".full-text").css({left:c,top:d}).show()})}function s(){a(".full-text .close").click(function(b){b.preventDefault(),a(this).parent().hide()})}function t(a,b,c,d){for(var e="",f=a.length,g=c.length,h="",i=!1,j=0;g>j;j++)i||(h+='<li data-fieldtype="'+d[j]+'"><a href="#">'+c[j]+"</a></li>"),c[j]==db&&(i=!0);for(i||(h+='<li data-fieldtype="-1"><a href="#">'+db+"</a></li>"),j=0;f>j;j++)e+='<td><div class="btn-group import-field-dropdown"><button data-toggle="dropdown" data-fieldtype="'+b[j]+'" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">'+a[j]+'</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+h+"</ul></div></td>";return e}function u(a,b){function c(a,b){for(var c,d="",e="",f=0;b>f;f++)e=a[f],e&&e.length>30&&(c=e,e=e.slice(0,30),e+=" <a class='show-full-text' href='#'>...</a>"+'<div class="full-text"><a href="#" class="close">×</a>'+c+"</div>"),d+="<td>"+e+"</td>";return d}for(var d="",e=a.length,f=0;e>f;f++)d+="<tr>"+c(a[f],b)+"</tr>";return d}function v(b){var c,d=[],e=0,f=[];U=0;var g=[],h=a(".ui-multiselect-menu:eq(0) .ui-multiselect-checkboxes li");switch(h.each(function(){a(this).hasClass("ui-multiselect-optgroup-label")&&(g[U++]=a(this).index())}),b){case"orders":var i=h.slice(g[0]+1,g[1]);c=i.find('input[aria-selected="true"]');break;case"orderLine":i=h.slice(g[1]+1),c=i.find('input[aria-selected="true"]');break;case"products":var j=a(".ui-multiselect-menu:eq(1) .ui-multiselect-checkboxes li");c=j.find('input[aria-selected="true"]');break;case"packs":var k=a(".ui-multiselect-menu:eq(2) .ui-multiselect-checkboxes li");c=k.find('input[aria-selected="true"]')}return U=0,c.each(function(){d[e++]=parseInt(a(this).val()),f[U++]=a(this).find("+span").text()}),{fieldsMap:d,headColArray:f}}function w(b,c,d,e){var f=a(".tab-pane.active").find(".export-table");f.html("");for(var g=[],h=c-1;h>=0;h--){g=[];for(var i=b.data[h].fieldsData,j=i.rowCount,k=Math.ceil(i.elems.length/j),l=0,m=0;j>m;m++){g[m]=[];for(var n=0;k>n;n++)g[m][n]=i.elems[l++]}var o,p=0;b.data[h].fieldsMap?(o=d.headColArray,e&&(o=h==c-1?d.headColArray:e.headColArray)):(o=g[0],p=1);var q='<div class="export-single-table"><table><thead><tr>'+y(o)+"</tr></thead><tbody>"+z(g,k,p)+"</tbody></table></div>";q+='<div class="report-link"><a href="'+b.data[h].url+'">Скачать отчет</a>',f.append(q)}}function y(a){var b="",c=a.length;for(Y=0;c>Y;Y++)b+="<td>"+a[Y]+"</td>";return b}function z(a,b,c){function d(a,b){for(var c,d="",e="",f=0;b>f;f++)e=a[f],e&&e.length>30&&(c=e,e=e.slice(0,30),e+=" <a class='show-full-text' href='#'>...</a>"+'<div class="full-text"><a href="#" class="close">×</a>'+c+"</div>"),d+="<td>"+e+"</td>";return d}for(var e="",f=a.length,g=c;f>g;g++)e+="<tr>"+d(a[g],b)+"</tr>";return e}function A(b){try{var c=a(".main-content"),d=b?b:c.height();d>K.height()?(d=b?b+100:c.height()+45,a("#sidebar").css("height",d)):a("#sidebar").css("height","100%")}catch(e){alert(e+" Функция setSidebarHeight")}}function B(b){var c=document.createElement("div");c.appendChild(document.createElement("div")),c.style.overflow="auto",c.style.overflowY="hidden",c.firstChild.style.width=b.scrollWidth+"px",c.firstChild.style.paddingTop="1px",c.firstChild.style.marginTop="-5px",c.firstChild.appendChild(document.createTextNode(" ")),c.onscroll=function(){b.scrollLeft=c.scrollLeft},b.onscroll=function(){c.scrollLeft=b.scrollLeft},b.parentNode.insertBefore(c,b),a(b).prev().addClass("top-scroll")}function C(){var c,d=a(".products-table>table");d.find("tbody tr").each(function(){var d=a(this).attr("id");c=b.client.getProductDetails(d);var e=c.imagesURLset,f=e.length,g="<div class='images-set'>";if(0!=f)for(var h=0;f>h;h++)g+="<div class='image-item map-item'><a href='#' class='remove-image-item remove-item'>&times</a><img src='"+e[h]+"'></div>";g+="</div><input type='file' id='imagesURLSet-"+d+"-"+f+"'>";for(var i=c.categories,j=i.length,k="",h=0;j>h;h++)k+="<div class='category-item map-item'><a href='#' class='remove-category-item remove-item'>&times</a>"+i[h]+"</div>";k+=D();var l=c.optionsMap,m="<table>";for(var n in l)m+="<tr><td><input type='text' value='"+n+"'></td><td><input type='text' value='"+l[n]+"'></td><td class='td-remove-options'><a href='' class='remove-options-item remove-item'>&times;</a></td></tr>";m+="</table><a href='#' class='add-options-item add-item'>Добавить</a>";var o=a(this);a("#imageURL-"+d).ace_file_input({style:"well",btn_choose:"",btn_change:null,no_icon:"",droppable:!0,icon_remove:null,thumbnail:"large"}).on("change",function(){o.find(".product-imageURL .file-label").css("opacity",1),o.find(".product-imageURL>img").hide()}),a(this).find(".product-fullDescr textarea").val(c.fullDescr),a(this).find(".product-imagesSet").html(g),a("#imagesURLSet-"+d+"-"+f).ace_file_input({style:"well",btn_choose:"Добавить",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var b=a(this);E(d,f,b)}),F(a(this).find(".ace-file-input")),a(this).find(".product-categories").html(k),G(a(this)),H(a(this)),a(this).find(".product-options").html(m),I(a(this)),J(a(this))})}function D(){for(var c=a(".backoffice.dynamic").attr("id"),d=b.client.getAllCategories(c),e=d.length,f="",g=0;e>g;g++)f+='<li id="'+d[g].id+'"><a href="#">'+d[g].name+"</a></li>";var h='<div class="btn-group categories-dropdown"><button data-toggle="dropdown" class="btn btn-info btn-sm dropdown-toggle no-border"><span class="btn-group-text">Добавить</span><span class="icon-caret-down icon-on-right"></span></button><ul class="dropdown-menu dropdown-blue">'+f+"</ul></div>";return h}function E(b,c,d){if(!d.parent().hasClass("added")){d.parent().addClass("added"),c++;var e="<input type='file' class='new-input' id='imagesURLSet-"+b+"-"+c+"'>";d.parent().after(e),a("#imagesURLSet-"+b+"-"+c).ace_file_input({style:"well",btn_choose:"Добавить",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var d=a(this);E(b,c,d)}),F(d.parent())}}function F(b){b.find(".remove").click(function(b){b.preventDefault(),a(this).closest(".ace-file-input").hide().detach()})}function G(b){b.find(".remove-category-item").click(function(b){b.preventDefault(),a(this).closest(".map-item").fadeOut(200)})}function H(b){b.find(".categories-dropdown .dropdown-menu a").click(function(b){b.preventDefault();var c='<div class="category-item map-item"><a href="#" class="remove-category-item remove-item">×</a>'+a(this).text()+"</div>";a(this).closest("td").find(".categories-dropdown").before(c),G(a(this).closest("td"))})}function I(b){b.find(".remove-options-item").click(function(b){b.preventDefault(),a(this).closest("tr").slideUp(200,function(){a(this).detach()})})}function J(b){b.find(".add-options-item ").click(function(b){b.preventDefault();var c='<tr><td><input type="text" value=""></td><td><input type="text" value=""></td><td class="td-remove-options"><a href="" class="remove-options-item remove-item">×</a></td></tr>';a(this).closest("td").find("table tbody").append(c),I(a(this).closest("td"))})}if(a(".container.backoffice").hasClass("noAccess"))bootbox.alert("У вас нет прав доступа !",function(){document.location.replace("./shop.jsp")});else{c.init();var K=a(window),L=parseInt((new Date).getTime()/1e3);L-=L%86400;var M=86400;e();var N,O;a(".delete-order").click(function(c){if(c.preventDefault(),!a(this).hasClass("passive")){var d=a(this).closest(".order-item"),e=d.data("orderid");b.client.deleteOrder(e),d.slideUp()}});try{var P=a("#date-picker-1"),Q=a(".datepicker-export");globalUserAuth=!0,P.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()}),console.log("---------------------"),Q.datepicker({autoclose:!0,language:"ru"}).next().on(ace.click_event,function(){a(this).prev().focus()});var R={createOrdersHtml:h,initOrderPlusMinus:f,setSidebarHeight:A,filterByStatus:o,filterByDelivery:k,filterBySearch:q};P.datepicker("setVarOrderDates",R),Q.datepicker("setVarOrderDates",R),a(".reset-filters").click(function(){e(),a(".type-delivery-dropdown .btn-group-text").text("Тип доставки"),a(".status-dropdown .btn-group-text").text("Статус заказа"),a("#back-search").val("Поиск по имени клиента или номеру телефона"),P.val("Фильтр по дате")})}catch(S){}a("#date-picker-2,#date-picker-3,#date-picker-4").val("Фильтр по дате"),a(".export .checkbox input.ace").prop("checked",!1),a(".status-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=a(this).find("a").text(),e=i(d),f=b.client.getOrdersByStatus(0,L+180*M,e);deliveryFilterFlag&&(f=k(f)),searchFilterFlag&&(f=q(f,a("#back-search").val())),dateFilterFlag&&(f=m(f)),a(".orders-list").html("").append(h(f)),n(),statusFilterFlag=1}),a(".type-delivery-dropdown .dropdown-menu li").click(function(c){c.preventDefault();var d=b.client.getOrdersByStatus(0,L+180*M,0),e=k(d);statusFilterFlag&&(e=o(e)),searchFilterFlag&&(e=q(e,a("#back-search").val())),dateFilterFlag&&(e=m(e)),a(".orders-list").html("").append(h(e)),n(),deliveryFilterFlag=1});var T=[],U=0;a(".back-orders .order-item").each(function(){T[U++]=a(this).find(".user-name").text()});var V=T.length,W=[],X=0;U=0;for(var Y=0;V-1>Y;Y++){X=0;for(var Z=Y+1;V>Z;Z++)T[Y]==T[Z]&&(X=1);X||(W[U++]=T[Y])}W[U]=T[V-1],a("#back-search").focus(function(){a(this).autocomplete({source:W,select:function(b,c){a(".orders-list").html("").append(h(p(c.item.label))),n()}})}),a(".search-form").submit(function(b){b.preventDefault();var c=a("#back-search").val();a(".orders-list").html("").append(h(p(c))),n()});var $,_,ab,bb,cb=[];a(".form-import").submit(function(c){c.preventDefault();var d=a("#import-data").val();if("Тип импортируемых данных"==a(".import-dropdown .btn-group-text").text())a(".import").find(".error-info").text("Пожалуйста, укажите тип импортируемых данных.").show();else if(d){{a("#import-public").val()}d=d.split("\\");var e=d.length,f=(d[e-1],new FormData),g=a(".form-import #import-data");f.append("data",g[0].files[0]),a.ajax({type:"POST",url:"/file/",cache:!1,processData:!1,contentType:!1,data:f,success:function(c){bb=c;var d=b.clientBO.parseCSVfile(bb);$=d.elems,_=d.rowCount;var e=$.length;ab=e/_;var f=0;cb=[];for(var g=0;_>g;g++){cb[g]=[];for(var h=0;ab>h;h++)cb[g][h]=$[f++]}var i=a(".import-dropdown .btn-group-text").text(),j=[],k=[],l=com.vmesteonline.be.shop.bo.ExchangeFieldType;switch(f=0,i){case"Продукты":for(var m in l)l[m]>=300&&l[m]<330&&(j[f]=m,k[f++]=l[m]);break;case"Категории продуктов":for(m in l)l[m]>=200&&l[m]<230&&(j[f]=m,k[f++]=l[m]);break;case"Производители":for(m in l)l[m]>=100&&l[m]<130&&(j[f]=m,k[f++]=l[m])}var n,o,p=j.slice(0),q=k.slice(0);if(f>ab)for(n=f,o=ab,g=n-1;g>=o;g--)j.pop(),k.pop();if(ab>f)for(n=ab,o=f,g=n-1;g>=o;g--)j[g]=db,k[g]=-1;var v="<table><thead><tr>"+t(j,k,p,q)+"</tr></thead><tbody>"+u(cb,j.length)+"</tbody></table>";a(".import-table").html("").prepend(v).parent().show(),a(".top-scroll").remove(),B(document.getElementById("doublescroll")),r(),s(),a(".import-field-dropdown .dropdown-toggle").click(function(b){b.preventDefault();var c=a(this).closest("td").index(),d=0,e=0;a(".import-table table").find("td").each(function(){c>e&&(d+=a(this).width()),e++}),d-=a(".import-table").scrollLeft();var f=94;a(this).parent().find(".dropdown-menu").css({left:d,top:f})}),a(".import-field-dropdown .dropdown-menu").find("li a").click(function(b){b.preventDefault();var c=a(this).parent().text(),d=a(this).parent().data("fieldtype");a(".import-field-dropdown").each(function(){a(this).find(".btn-group-text").text()==c&&(a(this).find(".dropdown-toggle").attr("data-fieldtype",-1),a(this).find(".btn-group-text").text(db))});var e=a(this).closest(".import-field-dropdown");e.find(".btn-group-text").text(c).parent().data("fieldtype",d)})}})}else a(".import").find(".error-info").text("Пожалуйста, выберите файл.").show()}),a("#import-data").click(function(){a(".import").find(".error-info").hide()}),a(".checkbox .lbl").click(function(){a(this).closest(".checkbox").toggleClass("active")}),a(".import-dropdown .dropdown-menu li").click(function(){a(".import").find(".error-info").hide()});var db="SKIP";a(".import-btn").click(function(c){function d(){a(".confirm-info").hide()}c.preventDefault();var e=a(".import-field-dropdown"),f=e.length,g="",h=!1;e.each(function(){if(!h)for(var b=a(this).parent().index(),c=a(this).find(".btn-group-text").text(),d=b+1;f>d;d++)if(c==e.eq(d).find(".btn-group-text").text()&&c!=db){g=c,h=!0;break}});var i=a(this).closest(".back-tab").find(".confirm-info");if(h)i.text("Вы указали два столбца с одинаковым занчением : "+g).show();else{i.hide();var j,k=a(".import-dropdown .btn-group-text").text();switch(k){case"Продукты":j=com.vmesteonline.be.shop.bo.ImExType.IMPORT_PRODUCTS;break;case"Категории продуктов":j=com.vmesteonline.be.shop.bo.ImExType.IMPORT_CATEGORIES;break;case"Производители":j=com.vmesteonline.be.shop.bo.ImExType.IMPORT_PRODUCERS}var l=[],m=0;a(".import .import-field-dropdown").each(function(){var b=a(this).find(".btn-group-text").text();b!=db&&(l[m]=parseInt(a(this).find(".btn").data("fieldtype"))),m++});var n=new com.vmesteonline.be.shop.bo.ImportElement;n.type=j,n.filename="filename",n.fieldsMap=l,n.url=bb;var o=[];o[0]=n;var p=new com.vmesteonline.be.shop.bo.DataSet;p.name="name",p.date=L,p.data=o,a(".loading").fadeIn(function(){try{b.clientBO.importData(p),i.text("Данные успешно импортированы.").addClass("info-good").show()}catch(c){i.text("Ошибка импорта.").show()}a(".loading").fadeOut(0),setTimeout(d,3e3)})}}),a(".export-orders-checklist select, .export-products-checklist select, .export-packs-checklist select").multiselect({noneSelectedText:"Опции",selectedText:"Опции (# выбрано)",checkAllText:"Выбрать все",uncheckAllText:"Отменить все"}),a(".ui-multiselect").addClass("btn btn-sm btn-info no-border"),a(".ui-multiselect .ui-icon").addClass("icon-caret-down"),a(".export .nav-tabs").find("li").click(function(){var b=a(this).index(),c=a(".export .tab-pane:eq("+b+")").addClass("active").height();A(c)}),a(".export-btn").click(function(c){c.preventDefault();var d=a(this).closest(".tab-pane"),e=d.find(".export-delivery-dropdown .btn-group-text").text(),f=d.find(".datepicker-export").attr("data-selectorderdate");if(f){d.find(".error-info").hide(),d.find(".confirm-info").hide();var g=a(".export .nav-tabs").find("li"),h=0;g.each(function(){a(this).hasClass("active")&&(h=a(this).index())});var i;i="Тип доставки"!=e&&"Все"!=e?j(e):0;var k;try{switch(h){case 0:var l=v("orders"),m=v("orderLine");k=b.clientBO.getTotalOrdersReport(f,i,l.fieldsMap,m.fieldsMap);var n;k.data&&(n=k.data.length,w(k,n,l,m));break;case 1:var o=v("products");k=b.clientBO.getTotalProductsReport(f,i,o.fieldsMap),k.data&&(n=k.data.length,w(k,n,o));break;case 2:o=v("packs"),k=b.clientBO.getTotalPackReport(f,i,o.fieldsMap),k.data&&(n=k.data.length,w(k,n,o))}r(),s(),k.data||d.find(".confirm-info").text("Нет данных на такое сочетание даты и типа доставки.").show(),A()}catch(c){d.find(".confirm-info").text("Ошибка экспорта.").show()}}else d.find(".error-info").text("Пожалуйста, укажите дату с заказом.").show()}),a(".container.backoffice .nav-list a").click(function(b){b.preventDefault(),a(".back-tab").hide();var c=a(this).parent().index();switch(c){case 0:a(".back-orders").show();break;case 1:a(".bo-edit").show(),C(),B(document.getElementById("doublescroll-2"));break;case 2:a(".export").show();break;case 3:a(".import").show();break;case 4:a(".bo-settings").show()}a(this).closest("ul").find(".active").removeClass("active"),a(this).parent().addClass("active"),A()}),a("#settings-logo").ace_file_input({style:"well",btn_choose:"Изменить логотип",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large",icon_remove:null}).on("change",function(){a(".logo-container>img").hide()}).parent().addClass("settings-logo"),a("#date-picker-6").datepicker({autoclose:!0,language:"ru"}),a(".settings-item .btn-save").click(function(){var c=a(this).closest(".settings-item").attr("id");switch(c){case"settings-common":var d=a("#settings-common"),e=new com.vmesteonline.be.shop.Shop;e.name=d.find(a("#name")).val(),e.descr=d.find(a("#descr")).val(),e.address=b.client.createDeliveryAddress(d.find(a("#address")).val()),b.clientBO.updateShop(e);break;case"settings-shedule":var f=new com.vmesteonline.be.shop.OrderDates;f.type=new com.vmesteonline.be.shop.OrderDatesType,f.orderDay="",f.orderBefore=a("#days-before").val(),f.eachOddEven="",f.priceTypeToUse="",b.clientBO.setDate(f);break;case"settings-delivery":}}),a(".shedule-dates td").click(function(b){b.preventDefault(),b.stopPropagation(),a(this).addClass("selected"),0==a(this).find(".remove-date").length&&a(this).append("<a class='remove-date' href='#'>&times;</a>"),a(this).find(".remove-date").click(function(b){b.preventDefault(),b.stopPropagation(),a(this).parent().removeClass("selected"),a(this).hide().detach()})}),a(".add-interval").click(function(b){b.preventDefault();var c,d=a(this).closest(".delivery-price-type").hasClass("delivery-interval");c=d?'<div class="delivery-interval new-interval delivery-price-type"><input type="text" placeholder="Интервал"><span>км</span>&nbsp;<input type="text" placeholder="Стоимость"><span>руб</span>&nbsp;<a href="#" class="add-delivery-interval remove-interval">&ndash;</a></div>':'<div class="delivery-weight new-interval delivery-price-type"><input type="text" placeholder="Интервал"><span>кг</span>&nbsp;<input type="text" placeholder="Стоимость"><span>руб</span>&nbsp;<a href="#" class="add-delivery-interval remove-interval">&ndash;</a></div>',a(this).closest(".delivery-price-type").after(c),a(".new-interval .remove-interval").click(function(b){b.preventDefault(),a(this).closest(".new-interval").slideUp(200,function(){a(this).detach()})}),a(".new-interval").slideDown().removeClass(".new-interval")}),a(".edit-show-add").click(function(b){b.preventDefault(),a(this).find("+.table-add").slideToggle();var c=a(".table-add-product table tr");a("#imageURL-add").ace_file_input({style:"well",btn_choose:"",btn_change:null,no_icon:"",droppable:!0,icon_remove:null,thumbnail:"large"}).on("change",function(){c.find(".product-imageURL .file-label").css("opacity",1),c.find(".product-imageURL>img").hide()}),a("#imageURLSet-add").ace_file_input({style:"well",btn_choose:"Добавить изображение",btn_change:null,no_icon:"",droppable:!0,thumbnail:"large"}).on("change",function(){var b=a(this);E(0,0,b)}),F(a(".table-add-product table .product-imagesSet"));var d=D(),e=a(".table-add-product .product-categories");e.html(d),G(e),H(e);var f=a(".table-add-product .product-options");I(f),J(f)}),a(".table-add-product .edit-add").click(function(){var c=a(".backoffice.dynamic").attr("id"),d=new com.vmesteonline.be.shop.FullProductInfo;d.product=new com.vmesteonline.be.shop.Product,d.details=new com.vmesteonline.be.shop.ProductDetails;var e=a(this).closest(".table-add-product").find("table tr");d.product.id=a(this).closest("tr").attr("id"),d.product.name=e.find(".product-name textarea").val(),d.product.shortDescr=e.find(".product-shortDescr textarea").val(),d.product.imageURL="",d.product.weight=e.find(".product-weight input").val(),d.product.price=e.find(".product-price input").val(),d.product.unitName=e.find(".product-unitName input").val(),d.product.minClientPack=e.find(".product-pack input").val(),d.product.prepackRequired=e.find(".product-prepack input").attr("checked")?!0:!1,d.product.producerId=e.find(".product-producer input").val(),d.details.fullDescr=e.find(".product-fullDescr textarea").val(),d.details.imagesURLset=e.find(".product-fullDescr textarea").val(),d.details.categories=e.find(".product-fullDescr textarea").val(),d.details.options=e.find(".product-fullDescr textarea").val(),b.clientBO.registerProduct(d,c),a(this).closest(".table-add-product").slideUp(function(){var b=e.clone();b.addClass("hidden"),a(".product-table table tbody").prepend(b),b.slideDown()})}),a(".product-remove a").click(function(c){c.preventDefault();var d=a(this).closest("tr").attr("id"),e=a(".backoffice.dynamic").attr("id");a(this).closest("tr").addClass("removing").fadeOut(600,function(){a(this).detach()}),b.clientBO.deleteProduct(d,e)}),a("#edit-product table input").change(function(){a(this).closest("tr").addClass("changed")}),a(".save-products").click(function(c){c.preventDefault(),a("#edit-product table .changed").each(function(){var c=new com.vmesteonline.be.shop.FullProductInfo;c.product=new com.vmesteonline.be.shop.Product,c.details=new com.vmesteonline.be.shop.ProductDetails,c.product.id=a(this).closest("tr").attr("id"),c.product.name=a(this).find("td:eq(0) input").val(),c.product.shortDescr=a(this).find("td:eq(1) input").val(),c.product.weight=a(this).find("td:eq(2) input").val(),c.product.price=a(this).find("td:eq(3) input").val(),b.clientBO.updateProduct(c)})}),a(".category-parent").each(function(){var b=D();a(this).html(b),a(this).find(".btn-group-text").text("Выбрать")})}a(".adminka-shops table tr").each(function(){var c=a(this).attr("id"),d=b.client.getShop(c),e=b.userClient.getUserInfoExt(d.ownerId);a(".owner-name span").text(e.firstName+" "+e.lastName)}),a(".update-owner-link").click(function(c){c.preventDefault();var d="<div class='update-owner-line'><input type='text' id='owner-email' placeholder='email нового владельца'><a href='#' class='btn btn-sm no-border btn-primary btn-update'>Изменить</a></div>",e=a(this).closest("td");0==e.find(".update-owner-line").length&&e.append(d),e.find(".update-owner-line").slideToggle(),e.find(".btn-update").click(function(){{var c=a(this).attr("id"),d=b.client.getShop(c);a("#owner-email").val()}d.ownerId=x,b.clientBO.updateShop(d)})}),a(".update-admins-link").click(function(b){b.preventDefault();var c="<div class='update-admins-line'><input type='text' id='owner-email' placeholder='email нового админа'><a href='#' class='btn btn-sm no-border btn-primary btn-update'>Добавить</a></div>",d=a(this).closest("td");0==d.find(".update-admins-line").length&&d.append(c),d.find(".update-admins-line").slideToggle(),d.find(".btn-update").click(function(){})}),a(".adminka .nav-list a").click(function(b){b.preventDefault(),a(".back-tab").hide();var c=a(this).parent().index();switch(c){case 0:a(".adminka-shops").show();break;case 1:a(".adminka-users").show()}a(this).closest("ul").find(".active").removeClass("active"),a(this).parent().addClass("active")})});