define("commonM.min",["jquery","shop-initThrift.min","shop-search.min","shop-common.min"],function(a,b,c,d){function e(){function e(){var c=document.location.hash;if("#edit-profile"!=c){var d={type:"page",pageName:"edit-profile"};window.history.pushState(d,null,"#"+d.pageName)}a(".save-changes").click(function(c){function d(){a(".save-status").removeClass("active"),a(".shop-editPersonal").hide(),a(".user-menu li:eq(0) a").trigger("click")}c.preventDefault();var e=a(".error-info");e.hide();var f=a("#edit-email"),g=a("#edit-phone"),h=a("#edit-name").val(),i=a("#edit-surname").val(),j=f.val(),k=g.val(),l=b.userClient.getUserInfo(),m=b.userClient.getUserContacts(),n=0;l.firstName=h,l.lastName=i,m.mobilePhone=k;var o=require("shop-common.min");o.isValidEmail(j)?m.email=j:(n=1,f.find("+.error-info").text("Некорректный email").show());try{b.userClient.updateUserContacts(m)}catch(c){n=1,g.find("+.error-info").text("Телефон должен быть вида 79219876543, +7(821)1234567 и т.п").show()}n||(b.userClient.updateUserInfo(l),a(".save-status").addClass("active"),o.changeShortUserInfo(l),setTimeout(d,2e3))}),a(".main-container").css("min-height",k.height()-115)}function g(d){if(a(".edit-personal-link").click(function(b){b.preventDefault(),a(".page").hide(),a(".shop-editPersonal").load("../ajax/ajax-editPersonal.jsp .dynamic",function(){a(".loading").show(0),e(),a(".loading").hide(0)}).show()}),d)a(".edit-personal-link").trigger("click");else{a("footer").removeClass("short-footer");var f=document.location.hash;if("#profile"!=f){var g,k={type:"page",pageName:"profile"};g=-1==f.indexOf("#")?f:"",window.history.pushState(k,null,g+"#"+k.pageName)}a(".main-container").css("min-height",a(window).height()-115),a(".sendConfirmCode").click(function(c){c.preventDefault();var d=b.userClient.getUserContacts().email,e="mailTemplates/changePasswordConfirm.html";b.authClient.sendConfirmCode(d,e),a(".confirm-info").text("На ваш e-mail отправлен код").addClass("info-good").show()}),a(".useConfirmCode").click(function(c){function d(){a(".account-no-confirm").slideUp(),a(".confirm-alert").hide()}c.preventDefault();var e=b.userClient.getUserContacts().email,f=a("#confirmCode").val(),g=a(".confirm-info");try{b.authClient.confirmRequest(e,f),g.text("Код принят !").addClass("info-good").show(),setTimeout(d,4e3)}catch(c){g.text("Неверный код подтверждения !").removeClass("info-good").show()}});var l=b.client.getUserDeliveryAddresses().elems,m=l.length;if(m>0){for(var n,o="",p=0;m>p;p++)n=b.client.getUserDeliveryAddress(l[p]),o+='<div class="user-address-item" data-index="'+p+'"><span>'+n.street.name+" "+n.building.fullNo+", кв. "+n.flatNo+'</span><a href="#" class="edit-user-addr">редактировать</a><a href="#" title="Удалить" class="remove-user-addr">&times;</a></div>';a(".user-addresses").prepend(o),j(a(".edit-user-addr").parent(),l)}var q=a(".form-edit-wrap").html();a(".add-user-address").click(function(b){b.preventDefault();var d=a(this).find("+.form-edit");0==d.length?(a(this).after(q),h(d),d=a(this).find("+.form-edit"),d.slideDown(200),i(d),c.initAutocompleteAddress(d)):"block"==d.css("display")?d.slideUp(200):d.slideDown(200)})}}function h(a,b){b?(a.find(".country-delivery").val(b.country.name),a.find(".city-delivery").val(b.city.name),a.find(".street-delivery").val(b.street.name),a.find(".building-delivery").val(b.building.fullNo),a.find(".flat-delivery").val(b.flatNo)):(a.find(".country-delivery").val(""),a.find(".city-delivery").val(""),a.find(".street-delivery").val(""),a.find(".building-delivery").val(""),a.find(".flat-delivery").val(""))}function i(c,d){c.find(".save-new-addr").click(function(c){c.preventDefault();var e=a(this).closest(".form-edit");e.prev().find(".edit-user-addr").text("редактировать");var f=parseInt(e.find(".flat-delivery").val());if(f){e.find(".error-info").hide();var g,h=require("shop-common.min"),i=e.find(".street-delivery").val(),k=e.find(".building-delivery").val(),l=!1;if(e.prev().hasClass("add-user-address"))try{g=b.client.createDeliveryAddress(i+" "+k,f,0,0,0),e.find(".error-info").hide();var m=a(".user-address-item").length;m||(m=1);var n='<div class="user-address-item no-init" data-index="'+m+'"><span>'+g.street.name+" "+g.building.fullNo+", кв. "+g.flatNo+'</span><a href="#" class="edit-user-addr">редактировать</a><a href="#" title="Удалить" class="remove-user-addr">&times;</a></div>';a(".user-addresses").prepend(n);var o=b.client.getUserDeliveryAddresses().elems,p=a(".user-address-item.no-init");j(p,o,g),p.removeClass("no-init")}catch(c){l=!0,e.find(".error-info").text("Такого адреса не существует !").show()}else try{g=b.client.createDeliveryAddress(i+" "+k,f,0,0,0),e.find(".error-info").hide(),e.prev().find("span").text(g.street.name+" "+g.building.fullNo+", кв. "+g.flatNo),d&&b.client.deleteDeliveryAddress(d.street.name+" "+d.building.fullNo)}catch(c){l=!0,e.find(".error-info").text("Такого адреса не существует !").show()}l||(h.addAddressToBase(e,g),e.slideUp())}else e.find(".error-info").text("Номер квартиры должен быть числом !").show()})}function j(e,f,g){var j=a(".form-edit-wrap").html();e.find(".edit-user-addr").click(function(e){e.preventDefault(),a(".form-edit-wrap").remove();var k=g,l=a(this).closest(".user-address-item");if(0==l.find("+.form-edit").length){l.after(j);var m=l.find("+.form-edit"),n=l.data("index");g||(k=b.client.getUserDeliveryAddress(f[n])),h(m,k);var o=d.addAddressToBase(m);i(m,o),c.initAutocompleteAddress(m)}l.find("+.form-edit").slideToggle(200,function(){var b=a(this).prev().find(".edit-user-addr");b.text("block"==l.find("+.form-edit").css("display")?"отменить":"редактировать")})}),e.find(".remove-user-addr").click(function(c){c.preventDefault();var d=a(this).closest(".user-address-item");d.slideUp(function(){var c,d=a(this).data("index");c=g?g:f[d],b.client.deleteDeliveryAddress(c)}),d.find("+.form-edit").slideUp()})}var k=a(window),l=a("#sidebar"),m=a(".show-left"),n=(k.height()-m.width())/2;m.css("top",n),l.css("min-height",k.height()),m.click(function(){a(this).hasClass("active")?(a(this).parent().animate({marginLeft:"-190px"},200),a(this).animate({marginLeft:"0"},200).removeClass("active")):(a(this).animate({"margin-left":"190px"},200).addClass("active"),a(this).parent().animate({marginLeft:0},200))}),a(".dropdown-menu li a").click(function(b){b.preventDefault(),a(this).closest(".btn-group").find(".btn-group-text").text(a(this).text())}),a('.nav-list a,.navbar .nav a:not(".dropdown-toggle")').click(function(b){var c=a(this).closest(".backoffice").length;c||a(this).hasClass("bo-link")||a(this).hasClass("no-prevent")||b.preventDefault(),a(this).closest("ul").find(".active").removeClass("active"),a(this).parent().addClass("active")}),a(".header-link").click(function(){var b=a(this).index();a(".page").hide(),2==b?a(".shop-terms-of-orders").load("../ajax/ajax-terms-of-orders.jsp .terms-of-orders",function(){}).show():3==b&&a(".shop-terms-of-delivery").load("../ajax/ajax-terms-of-delivery.jsp .terms-of-delivery",function(){}).show()}),a(".user-menu a").click(function(b,c){b.preventDefault();var d=c?c:!1;a(".navbar .nav .active").removeClass("active"),a(this).closest(".user-short").removeClass("open"),b.stopPropagation();var e=a(this).parent().index();0==e?(a(".page").hide(),a(".shop-profile").load("../ajax/ajax-profile.jsp .dynamic",function(){g(d)}).show()):f()}),d.setSidebarHeight()}function f(){b.authClient.logout();var a=document.location.href;-1!=a.indexOf("backoffice")?(-1!=a.indexOf("#")&&(a=a.split("#")[0]),a=a.replace("backoffice","shop")):-1!=a.indexOf("#")&&(a=a.split("#")[0]),document.location.replace(a)}return{init:e,logout:f}});