define("shop-category",["jquery","shop-initThrift","shop-basket","shop-common","shop-spinner","shop-search"],function(a,b,c,d,e){function f(a){var c=a.length,d="";for(i=0;c>i;i++){var e="";a[i].unitName&&(e=a[i].unitName);var f,g;m=m?m:b.client.getProducers(),n=n?n:m.length;for(var h=0;n>h;h++)if(m[h].id==a[i].producerId){f=m[h].name,g=m[h].id;break}var j,k=require("shop-common");j=a[i].imageURL?a[i].imageURL:k.noPhotoPic,d+='<tr class="product new" data-prepack="'+a[i].prepackRequired+'" data-productid="'+a[i].id+'"><td><a href="#" class="product-link"><div class="product-pic"><img src="'+j+'?w=40&h=40" alt="фото"/></div><span><span class="product-name">'+a[i].name+"</span>"+a[i].shortDescr+'</span></a><div class="modal"></div></td><td class="td-producer" data-producerid="'+g+'">'+f+'</td><td class="product-price">'+a[i].price+'</td><td class="td-spinner"><input type="text" data-step="'+a[i].minClientPack+'" class="input-mini spinner1" /> <span class="added-text">добавлен</span></td><td><span class="unit-name">'+e+'</span></td><td><a href="#" title="Добавить в корзину" class="fa fa-shopping-cart"></a><span href="#" title="Продукт уже у вас в корзине" class="fa fa-check"></span></td></tr>'}return d}function g(c){var d=require("shop-common"),g=b.client.getProductCategories(c),h=g.length,i="",m="";(g[0]&&0!=g[0].parentId||void 0===g[0])&&(m='<li><a class="shopmenu-back" href="#"><i class="fa fa-reply-all"></i><span>Назад</span></a></li>');for(var n=0;h>n;n++){var o=50-2*n;if(i+='<li data-parentid="'+g[n].parentId+'" data-catid="'+g[n].id+'"><a href="#" style="z-index: '+o+'" class="btn btn-app btn-info btn-sm"><span>'+g[n].name+"</span></a>",g[n].socialNetworks){i+='<div class="category-label no-init"></div><div class="category-soc-links" style="z-index: '+--o+'">';var s=g[n].socialNetworks,t=(g[n].socialNetworks.length," ");for(var u in s)""!=s[u]&&("vk"==u?t="../i/vk.png":"fb"==u&&(t="../i/fb.png"),i+='<a class="category-soc-single" target="_blank" href="'+s[u]+'"><img src="'+t+'" alt="картинка"/></a>');i+="</div>"}i+="</li>"}a(".shop-menu ul").html(m).append(i);var v=a(".category-label.no-init");k(v),v.removeClass(".no-init");var w=p=b.client.getProducts(0,1e3,c).products;w=w.slice(0,25),a(".main-content .catalog table tbody").html("").append(f(w)),d.markAddedProduct();var x=a(".producer-dropdown .btn").data("producerid");if(0!=x){var y=require("shop-search");y.filterByProducer(x)}e.initProductsSpinner(a(".product.new"));var z=require("shop-basket");d.InitProductDetailPopup(a(".product.new .product-link")),z.InitAddToBasket(a(".product.new .fa-shopping-cart")),j(),d.setSidebarHeight(),l(),a(".product.new").removeClass("new"),r=!1,q=25}function h(a){var b,c=a.split(";"),d=c.length,e=d-1;if(0>e)b=0;else{var f=c[e].split("=");b=f[1]}o=b,g(b)}function j(){a(".shop-menu li a").click(function(b,c){if(!a(this).hasClass("category-soc-single")){b.preventDefault(),a(".main-content .catalog").removeClass("searched").removeAttr("data-searchWord");var d,e=a(this).hasClass("shopmenu-back"),f=a(this).parent().data("catid"),i=document.location.hash;e?(d=document.location.hash.split(";"),d.pop(),d=d.join(";"),h(d),0==d.length&&(d=" ")):(d=i?i+";cat="+f:"#cat="+f,o=f,g(f));var j=c?c:!1;if(!j){var k={type:"category",categoriesHash:d};window.history.pushState(k,null,d)}}})}function k(b){b.hover(function(){var b=a(this).find("+.category-soc-links"),c=b.width()+2;b.animate({right:-c+"px"},200)},function(){})}function l(){a(".shop-menu li").hover(function(){a(".category-soc-links.active").removeClass("active"),a(this).find(".category-soc-links").addClass("active");var b=a('.category-soc-links:not(".active")');b.animate({right:"0"},200)},function(){var b=a(".category-soc-links");b.animate({right:"0"},200)})}var m=b.client.getProducers(),n=m.length;k(a(".category-label")),l();var o=0,p=b.client.getProducts(0,1e3,o).products,q=25,r=!1;return productsListGlobalLen=p.length,0!=a(".shop-page").length&&"none"!=a(".shop-page").css("display")&&a(window).scroll(function(){var c=a(window).height(),d=a(".shop-page").height();if(d>c&&c+a(this).scrollTop()>d-100&&(p.length||(o||(o=0),p=b.client.getProducts(0,1e3,o).products,productsListGlobalLen=p.length),!r)){q+25>productsListGlobalLen?(end=productsListGlobalLen,r=!0):end=q+25;var g=p.slice(q,end);q+=25,a(".main-content .catalog table tbody").append(f(g));var h=require("shop-common");h.markAddedProduct();var i=a(".producer-dropdown .btn").data("producerid");if(0!=i){var j=require("shop-search");j.filterByProducer(i)}e.initProductsSpinner(a(".product.new"));var k=require("shop-basket");h.InitProductDetailPopup(a(".product.new .product-link")),k.InitAddToBasket(a(".product.new .fa-shopping-cart")),h.setSidebarHeight(),a(".product.new").removeClass("new")}}),{createProductsTableHtml:f,InitLoadCategory:g,InitClickOnCategory:j,LoadCategoryByURLHash:h}});